<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - ë‹¤ë‹´ê°€êµ¬</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Noto Sans KR', sans-serif;
        background-color: #f5f5f5;
        min-height: 100vh;
      }

      /* Sidebar */
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        width: 250px;
        height: 100vh;
        background: #1a1a2e;
        color: white;
        padding: 20px 0;
        z-index: 1000;
      }

      .sidebar-logo {
        padding: 0 20px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 20px;
      }

      .sidebar-logo h1 {
        font-size: 1.3rem;
        font-weight: 700;
      }

      .sidebar-logo span {
        font-size: 0.8rem;
        color: #888;
      }

      .nav-menu {
        list-style: none;
      }

      .nav-menu li a {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 20px;
        color: #aaa;
        text-decoration: none;
        transition: all 0.3s;
      }

      .nav-menu li a:hover,
      .nav-menu li a.active {
        background: rgba(255, 255, 255, 0.1);
        color: white;
      }

      .nav-menu li a.active {
        border-left: 3px solid #007bff;
      }

      .nav-icon {
        width: 20px;
        text-align: center;
      }

      .sidebar-footer {
        position: absolute;
        bottom: 20px;
        left: 0;
        right: 0;
        padding: 0 20px;
      }

      .sidebar-footer a {
        display: block;
        padding: 10px;
        text-align: center;
        background: rgba(255, 255, 255, 0.1);
        color: #aaa;
        text-decoration: none;
        border-radius: 5px;
        font-size: 0.9rem;
      }

      .sidebar-footer a:hover {
        background: rgba(255, 255, 255, 0.2);
        color: white;
      }

      /* Main Content */
      .main-content {
        margin-left: 250px;
        padding: 20px 30px;
      }

      /* Header */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #ddd;
      }

      .header h2 {
        font-size: 1.5rem;
        color: #333;
      }

      .admin-info {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .admin-avatar {
        width: 40px;
        height: 40px;
        background: #007bff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
      }

      .admin-name {
        font-size: 0.9rem;
        color: #333;
      }

      .admin-role {
        font-size: 0.75rem;
        color: #888;
      }

      /* Stats Cards */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .stat-card .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-bottom: 15px;
      }

      .stat-card.users .stat-icon {
        background: #e3f2fd;
        color: #1976d2;
      }

      .stat-card.expert .stat-icon {
        background: #fff3e0;
        color: #f57c00;
      }

      .stat-card.consultations .stat-icon {
        background: #e8f5e9;
        color: #388e3c;
      }

      .stat-card.pending .stat-icon {
        background: #fce4ec;
        color: #c2185b;
      }

      .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 0.9rem;
        color: #888;
      }

      .stat-change {
        font-size: 0.8rem;
        margin-top: 10px;
      }

      .stat-change.positive {
        color: #388e3c;
      }

      .stat-change.negative {
        color: #c2185b;
      }

      /* Content Grid */
      .content-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
      }

      @media (max-width: 1200px) {
        .content-grid {
          grid-template-columns: 1fr;
        }
      }

      /* Card */
      .card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #eee;
      }

      .card-header h3 {
        font-size: 1.1rem;
        color: #333;
      }

      .card-header a {
        font-size: 0.85rem;
        color: #007bff;
        text-decoration: none;
      }

      .card-body {
        padding: 20px;
      }

      /* Recent Table */
      .recent-table {
        width: 100%;
        border-collapse: collapse;
      }

      .recent-table th,
      .recent-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      .recent-table th {
        font-weight: 500;
        color: #888;
        font-size: 0.85rem;
      }

      .recent-table td {
        font-size: 0.9rem;
        color: #333;
      }

      .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 500;
      }

      .badge.standard {
        background: #e0e0e0;
        color: #616161;
      }
      .badge.expert {
        background: #fff3e0;
        color: #f57c00;
      }
      .badge.business {
        background: #e8f5e9;
        color: #388e3c;
      }
      .badge.pending {
        background: #fff3e0;
        color: #f57c00;
      }
      .badge.approved {
        background: #e8f5e9;
        color: #388e3c;
      }
      .badge.rejected {
        background: #ffebee;
        color: #c62828;
      }

      /* Quick Actions */
      .quick-actions {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .quick-action-btn {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 15px;
        border: 1px solid #eee;
        border-radius: 8px;
        text-decoration: none;
        color: #333;
        transition: all 0.3s;
      }

      .quick-action-btn:hover {
        background: #f5f5f5;
        border-color: #ddd;
      }

      .quick-action-btn .action-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
      }

      .quick-action-btn .action-text h4 {
        font-size: 0.95rem;
        margin-bottom: 3px;
      }

      .quick-action-btn .action-text p {
        font-size: 0.8rem;
        color: #888;
      }

      /* Activity Feed */
      .activity-item {
        display: flex;
        gap: 15px;
        padding: 15px 0;
        border-bottom: 1px solid #eee;
      }

      .activity-item:last-child {
        border-bottom: none;
      }

      .activity-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        flex-shrink: 0;
      }

      .activity-icon.user {
        background: #e3f2fd;
        color: #1976d2;
      }
      .activity-icon.tier {
        background: #fff3e0;
        color: #f57c00;
      }
      .activity-icon.consultation {
        background: #e8f5e9;
        color: #388e3c;
      }

      .activity-content p {
        font-size: 0.9rem;
        color: #333;
        margin-bottom: 3px;
      }

      .activity-content span {
        font-size: 0.8rem;
        color: #888;
      }

      /* Loading */
      .loading {
        text-align: center;
        padding: 40px;
        color: #888;
      }

      /* Access Denied */
      .access-denied {
        display: none;
        text-align: center;
        padding: 100px 20px;
      }

      .access-denied h2 {
        font-size: 1.5rem;
        color: #c62828;
        margin-bottom: 15px;
      }

      .access-denied p {
        color: #666;
        margin-bottom: 20px;
      }

      .access-denied a {
        color: #007bff;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
          transition: transform 0.3s;
        }

        .sidebar.open {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }

        .stats-grid {
          grid-template-columns: 1fr 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <nav class="sidebar">
      <div class="sidebar-logo">
        <h1>ë‹¤ë‹´ê°€êµ¬</h1>
        <span>ê´€ë¦¬ì íŒ¨ë„</span>
      </div>

      <ul class="nav-menu">
        <li>
          <a href="index.html" class="active">
            <span class="nav-icon">ğŸ“Š</span>
            ëŒ€ì‹œë³´ë“œ
          </a>
        </li>
        <li>
          <a href="users.html">
            <span class="nav-icon">ğŸ‘¥</span>
            íšŒì› ê´€ë¦¬
          </a>
        </li>
        <li>
          <a href="expert-requests.html">
            <span class="nav-icon">â­</span>
            Expert ìŠ¹ê¸‰ ê´€ë¦¬
          </a>
        </li>
        <li>
          <a href="consultations.html">
            <span class="nav-icon">ğŸ’¬</span>
            ìƒë‹´ ê´€ë¦¬
          </a>
        </li>
        <li>
          <a href="logs.html">
            <span class="nav-icon">ğŸ“‹</span>
            í™œë™ ë¡œê·¸
          </a>
        </li>
        <li>
          <a href="settings.html">
            <span class="nav-icon">âš™ï¸</span>
            ì„¤ì •
          </a>
        </li>
      </ul>

      <div class="sidebar-footer">
        <a href="../index.html">â† ë©”ì¸ ì‚¬ì´íŠ¸ë¡œ</a>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Access Denied Message -->
      <div class="access-denied" id="accessDenied">
        <h2>ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤</h2>
        <p>ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
        <a href="../index.html">ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
      </div>

      <!-- Dashboard Content -->
      <div id="dashboardContent" style="display: none">
        <!-- Header -->
        <header class="header">
          <h2>ëŒ€ì‹œë³´ë“œ</h2>
          <div class="admin-info">
            <div>
              <div class="admin-name" id="adminName">ê´€ë¦¬ì</div>
              <div class="admin-role" id="adminRole">Super Admin</div>
            </div>
            <div class="admin-avatar" id="adminAvatar">A</div>
          </div>
        </header>

        <!-- Stats -->
        <div class="stats-grid">
          <div class="stat-card users">
            <div class="stat-icon">ğŸ‘¥</div>
            <div class="stat-value" id="totalUsers">-</div>
            <div class="stat-label">ì „ì²´ íšŒì›</div>
            <div class="stat-change positive" id="newUsersToday">ì˜¤ëŠ˜ +0ëª…</div>
          </div>

          <div class="stat-card expert">
            <div class="stat-icon">â­</div>
            <div class="stat-value" id="expertUsers">-</div>
            <div class="stat-label">Expert íšŒì›</div>
            <div class="stat-change" id="pendingUpgrades">ìŠ¹ê¸‰ ëŒ€ê¸° 0ê±´</div>
          </div>

          <div class="stat-card consultations">
            <div class="stat-icon">ğŸ’¬</div>
            <div class="stat-value" id="totalConsultations">-</div>
            <div class="stat-label">ìƒë‹´ ì‹ ì²­</div>
            <div class="stat-change" id="thisMonthConsultations">ì´ë²ˆ ë‹¬ 0ê±´</div>
          </div>

          <div class="stat-card pending">
            <div class="stat-icon">â³</div>
            <div class="stat-value" id="pendingItems">-</div>
            <div class="stat-label">ì²˜ë¦¬ ëŒ€ê¸°</div>
            <div class="stat-change">ì¦‰ì‹œ í™•ì¸ í•„ìš”</div>
          </div>
        </div>

        <!-- Content Grid -->
        <div class="content-grid">
          <!-- Recent Users -->
          <div class="card">
            <div class="card-header">
              <h3>ìµœê·¼ ê°€ì… íšŒì›</h3>
              <a href="users.html">ì „ì²´ ë³´ê¸° â†’</a>
            </div>
            <div class="card-body">
              <table class="recent-table">
                <thead>
                  <tr>
                    <th>ì´ë¦„</th>
                    <th>ì´ë©”ì¼</th>
                    <th>ë“±ê¸‰</th>
                    <th>ê°€ì…ì¼</th>
                  </tr>
                </thead>
                <tbody id="recentUsers">
                  <tr>
                    <td colspan="4" class="loading">ë¡œë”© ì¤‘...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Right Column -->
          <div>
            <!-- Quick Actions -->
            <div class="card" style="margin-bottom: 20px">
              <div class="card-header">
                <h3>ë¹ ë¥¸ ì‘ì—…</h3>
              </div>
              <div class="card-body quick-actions">
                <a href="expert-requests.html" class="quick-action-btn">
                  <div class="action-icon" style="background: #fff3e0; color: #f57c00">â­</div>
                  <div class="action-text">
                    <h4>Expert ìŠ¹ê¸‰ ê²€í† </h4>
                    <p id="pendingExpertCount">ëŒ€ê¸° ì¤‘ 0ê±´</p>
                  </div>
                </a>
                <a href="consultations.html" class="quick-action-btn">
                  <div class="action-icon" style="background: #e8f5e9; color: #388e3c">ğŸ’¬</div>
                  <div class="action-text">
                    <h4>ìƒë‹´ ìš”ì²­ í™•ì¸</h4>
                    <p id="pendingConsultCount">ëŒ€ê¸° ì¤‘ 0ê±´</p>
                  </div>
                </a>
                <a href="users.html?filter=new" class="quick-action-btn">
                  <div class="action-icon" style="background: #e3f2fd; color: #1976d2">ğŸ‘¤</div>
                  <div class="action-text">
                    <h4>ì‹ ê·œ íšŒì› í™•ì¸</h4>
                    <p id="newMemberCount">ì˜¤ëŠ˜ 0ëª…</p>
                  </div>
                </a>
              </div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
              <div class="card-header">
                <h3>ìµœê·¼ í™œë™</h3>
                <a href="logs.html">ì „ì²´ ë³´ê¸° â†’</a>
              </div>
              <div class="card-body" id="recentActivity">
                <div class="loading">ë¡œë”© ì¤‘...</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      // Supabase ì„¤ì •
      const SUPABASE_URL = 'https://vvqrvgcgnlfpiqqndsve.supabase.co';
      const SUPABASE_ANON_KEY =
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2cXJ2Z2NnbmxmcGlxcW5kc3ZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4NTYyMjYsImV4cCI6MjA4MzQzMjIyNn0.WvMdB2bojqRUjYWdljAcxP1yHqQZJwuyv2equltyWWQ';

      let supabaseClient = null;
      let currentUser = null;

      // ê´€ë¦¬ì ì´ë©”ì¼ ëª©ë¡ (ì‹¤ì œë¡œëŠ” admin_roles í…Œì´ë¸”ì—ì„œ í™•ì¸)
      const ADMIN_EMAILS = ['dadamfurniture@gmail.com'];

      document.addEventListener('DOMContentLoaded', async () => {
        await initAdmin();
      });

      async function initAdmin() {
        if (typeof window.supabase === 'undefined') {
          console.error('Supabase not loaded');
          showAccessDenied();
          return;
        }

        supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ì„¸ì…˜ í™•ì¸
        const {
          data: { session },
        } = await supabaseClient.auth.getSession();

        if (!session) {
          showAccessDenied();
          return;
        }

        currentUser = session.user;

        // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ (ê°„ë‹¨í•œ ì´ë©”ì¼ ê¸°ë°˜ í™•ì¸)
        if (!ADMIN_EMAILS.includes(currentUser.email)) {
          // TODO: admin_roles í…Œì´ë¸”ì—ì„œ í™•ì¸
          showAccessDenied();
          return;
        }

        // ëŒ€ì‹œë³´ë“œ í‘œì‹œ
        document.getElementById('dashboardContent').style.display = 'block';

        // ê´€ë¦¬ì ì •ë³´ í‘œì‹œ
        const meta = currentUser.user_metadata || {};
        document.getElementById('adminName').textContent = meta.name || currentUser.email;
        document.getElementById('adminAvatar').textContent = (meta.name || currentUser.email).charAt(0).toUpperCase();

        // ë°ì´í„° ë¡œë“œ
        await loadDashboardData();
      }

      function showAccessDenied() {
        document.getElementById('accessDenied').style.display = 'block';
        document.getElementById('dashboardContent').style.display = 'none';
      }

      async function loadDashboardData() {
        try {
          // ì‚¬ìš©ì í†µê³„ ë¡œë“œ (auth.usersëŠ” ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€, ëŒ€ì•ˆ í•„ìš”)
          // ì‹¤ì œë¡œëŠ” ì„œë²„ í•¨ìˆ˜ë‚˜ ë³„ë„ í…Œì´ë¸” ì‚¬ìš©
          await loadUserStats();
          await loadRecentUsers();
          await loadRecentActivity();
        } catch (error) {
          console.error('Error loading dashboard data:', error);
        }
      }

      async function loadUserStats() {
        let pendingExpert = 0;
        let pendingConsult = 0;

        // profile_stats ë·°ì—ì„œ ì‚¬ìš©ì í†µê³„ ë¡œë“œ
        try {
          const { data: stats, error } = await supabaseClient.from('profile_stats').select('*').single();

          if (!error && stats) {
            document.getElementById('totalUsers').textContent = stats.total_users || 0;
            document.getElementById('expertUsers').textContent =
              (stats.expert_users || 0) + (stats.business_users || 0);
            document.getElementById('newUsersToday').textContent = `ì˜¤ëŠ˜ +${stats.today_signups || 0}ëª…`;
          } else {
            // ë·°ê°€ ì—†ìœ¼ë©´ profiles í…Œì´ë¸”ì—ì„œ ì§ì ‘ ì¡°íšŒ
            const { data: profiles, count } = await supabaseClient.from('profiles').select('tier', { count: 'exact' });

            if (profiles) {
              const expertCount = profiles.filter((p) => p.tier === 'expert' || p.tier === 'business').length;
              document.getElementById('totalUsers').textContent = count || profiles.length;
              document.getElementById('expertUsers').textContent = expertCount;
            }
          }
        } catch (e) {
          console.log('í”„ë¡œí•„ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', e.message);
          document.getElementById('totalUsers').textContent = '-';
          document.getElementById('expertUsers').textContent = '-';
        }

        // Expert ìŠ¹ê¸‰ ëŒ€ê¸° ê±´ìˆ˜
        try {
          const { data: expertRequests, error } = await supabaseClient
            .from('expert_requests')
            .select('id')
            .eq('status', 'pending');

          if (!error && expertRequests) {
            pendingExpert = expertRequests.length;
            document.getElementById('pendingExpertCount').textContent = `ëŒ€ê¸° ì¤‘ ${pendingExpert}ê±´`;
            document.getElementById('pendingUpgrades').textContent = `ìŠ¹ê¸‰ ëŒ€ê¸° ${pendingExpert}ê±´`;
          }
        } catch (e) {
          console.log('expert_requests í…Œì´ë¸”ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.');
        }

        // ìƒë‹´ í†µê³„
        try {
          const { data: allConsult } = await supabaseClient.from('consultations').select('id');
          const { data: pendingConsultations } = await supabaseClient
            .from('consultations')
            .select('id')
            .eq('status', 'pending');

          if (allConsult) {
            document.getElementById('totalConsultations').textContent = allConsult.length;
          }
          if (pendingConsultations) {
            pendingConsult = pendingConsultations.length;
            document.getElementById('pendingConsultCount').textContent = `ëŒ€ê¸° ì¤‘ ${pendingConsult}ê±´`;
            document.getElementById('thisMonthConsultations').textContent = `ëŒ€ê¸° ${pendingConsult}ê±´`;
          }
        } catch (e) {
          console.log('consultations í…Œì´ë¸”ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.');
          document.getElementById('totalConsultations').textContent = '-';
        }

        // ì´ ëŒ€ê¸° ê±´ìˆ˜
        document.getElementById('pendingItems').textContent = pendingExpert + pendingConsult;
      }

      async function loadRecentUsers() {
        const tbody = document.getElementById('recentUsers');

        try {
          const { data: users, error } = await supabaseClient
            .from('profiles')
            .select('*')
            .order('created_at', { ascending: false })
            .limit(5);

          if (error) throw error;

          if (!users || users.length === 0) {
            tbody.innerHTML = `
                        <tr>
                            <td colspan="4" style="text-align: center; color: #888; padding: 30px;">
                                ì•„ì§ ê°€ì…í•œ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.
                            </td>
                        </tr>
                    `;
            return;
          }

          tbody.innerHTML = users
            .map(
              (user) => `
                    <tr>
                        <td>${user.name || '-'}</td>
                        <td>${user.email || '-'}</td>
                        <td><span class="badge ${user.tier || 'standard'}">${(user.tier || 'standard').charAt(0).toUpperCase() + (user.tier || 'standard').slice(1)}</span></td>
                        <td>${formatDate(user.created_at)}</td>
                    </tr>
                `
            )
            .join('');
        } catch (e) {
          console.log('profiles í…Œì´ë¸” ì¡°íšŒ ì‹¤íŒ¨:', e.message);
          tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; color: #888; padding: 30px;">
                            profiles í…Œì´ë¸”ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                            <small>database/profiles-schema.sqlì„ ì‹¤í–‰í•˜ì„¸ìš”.</small>
                        </td>
                    </tr>
                `;
        }
      }

      async function loadRecentActivity() {
        const container = document.getElementById('recentActivity');

        try {
          const { data: logs, error } = await supabaseClient
            .from('admin_logs')
            .select('*')
            .order('created_at', { ascending: false })
            .limit(5);

          if (error) throw error;

          if (!logs || logs.length === 0) {
            container.innerHTML = `
                        <div style="text-align: center; color: #888; padding: 20px;">
                            ì•„ì§ í™œë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    `;
            return;
          }

          container.innerHTML = logs
            .map(
              (log) => `
                    <div class="activity-item">
                        <div class="activity-icon ${getActivityIconClass(log.action_type)}">
                            ${getActivityIcon(log.action_type)}
                        </div>
                        <div class="activity-content">
                            <p>${log.description || log.action_type}</p>
                            <span>${formatDate(log.created_at)}</span>
                        </div>
                    </div>
                `
            )
            .join('');
        } catch (e) {
          container.innerHTML = `
                    <div style="text-align: center; color: #888; padding: 20px;">
                        í™œë™ ë¡œê·¸ í…Œì´ë¸”ì´ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>
                        <small>admin-schema.sqlì„ Supabaseì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”.</small>
                    </div>
                `;
        }
      }

      function getActivityIcon(actionType) {
        const icons = {
          user_update: 'ğŸ‘¤',
          tier_change: 'â­',
          consultation_update: 'ğŸ’¬',
          login: 'ğŸ”‘',
        };
        return icons[actionType] || 'ğŸ“';
      }

      function getActivityIconClass(actionType) {
        const classes = {
          user_update: 'user',
          tier_change: 'tier',
          consultation_update: 'consultation',
        };
        return classes[actionType] || 'user';
      }

      function formatDate(dateStr) {
        const date = new Date(dateStr);
        const now = new Date();
        const diff = now - date;

        if (diff < 60000) return 'ë°©ê¸ˆ ì „';
        if (diff < 3600000) return `${Math.floor(diff / 60000)}ë¶„ ì „`;
        if (diff < 86400000) return `${Math.floor(diff / 3600000)}ì‹œê°„ ì „`;
        if (diff < 604800000) return `${Math.floor(diff / 86400000)}ì¼ ì „`;

        return date.toLocaleDateString('ko-KR');
      }
    </script>
  </body>
</html>
