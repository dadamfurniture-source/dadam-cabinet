<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#B8956C" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <title>AI ÏÑ§Í≥Ñ - Îã§Îã¥Í∞ÄÍµ¨</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Noto+Serif+KR:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <script src="js/config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      :root {
        --white: #fafafa;
        --cream: #f8f7f4;
        --warm: #ebe8e2;
        --gray: #8b8680;
        --charcoal: #2d2a26;
        --black: #1a1918;
        --gold: #b8956c;
        --gold-light: #d4b896;
      }
      body {
        font-family:
          'Pretendard',
          -apple-system,
          BlinkMacSystemFont,
          system-ui,
          sans-serif;
        background: var(--white);
        color: var(--charcoal);
        line-height: 1.7;
        -webkit-tap-highlight-color: transparent;
      }
      h1,
      h2,
      h3,
      h4 {
        font-family: 'Playfair Display', 'Noto Serif KR', serif;
        font-weight: 500;
      }
      a {
        text-decoration: none;
        color: inherit;
      }
      button {
        -webkit-tap-highlight-color: transparent;
      }

      /* Navigation */
      .nav {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 100;
        padding: 0 48px;
        height: 72px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(255, 255, 255, 0.97);
        backdrop-filter: blur(10px);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      }
      .nav-logo {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--charcoal);
      }
      .nav-logo svg {
        width: 28px;
        height: 28px;
      }
      .nav-logo span {
        font-family: 'Playfair Display', serif;
        font-size: 22px;
      }
      .nav-menu {
        display: flex;
        gap: 28px;
      }
      .nav-menu a {
        color: var(--charcoal);
        font-size: 13px;
        letter-spacing: 0.5px;
        transition: all 0.3s;
      }
      .nav-menu a:hover {
        opacity: 0.7;
      }
      .nav-menu a.active {
        color: var(--gold);
        font-weight: 500;
      }
      .nav-icons {
        display: flex;
        align-items: center;
        gap: 20px;
        color: var(--charcoal);
      }
      .nav-icons button {
        background: none;
        border: none;
        color: inherit;
        cursor: pointer;
        padding: 4px;
      }
      .login-btn {
        padding: 8px 20px;
        background: var(--charcoal);
        color: #fff;
        border-radius: 20px;
        font-size: 13px;
        transition: all 0.3s;
      }
      .login-btn:hover {
        background: var(--gold);
      }
      .user-menu {
        position: relative;
      }
      .user-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-radius: 20px;
        background: var(--cream);
        border: none;
        color: inherit;
        cursor: pointer;
        transition: all 0.3s;
      }
      .user-btn:hover {
        background: var(--warm);
      }
      .user-avatar {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: var(--gold);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
        color: #fff;
      }
      .user-name {
        font-size: 13px;
        max-width: 100px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .user-dropdown {
        position: absolute;
        top: calc(100% + 8px);
        right: 0;
        min-width: 180px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s;
        z-index: 200;
      }
      .user-menu:hover .user-dropdown {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }
      .user-dropdown a,
      .user-dropdown button {
        display: flex;
        align-items: center;
        gap: 10px;
        width: 100%;
        padding: 12px 16px;
        font-size: 14px;
        color: var(--charcoal);
        background: none;
        border: none;
        cursor: pointer;
        transition: background 0.2s;
        text-align: left;
      }
      .user-dropdown a:hover,
      .user-dropdown button:hover {
        background: var(--cream);
      }
      .user-dropdown svg {
        width: 18px;
        height: 18px;
        color: var(--gray);
      }

      .hamburger {
        display: none;
        flex-direction: column;
        gap: 5px;
        padding: 8px;
        cursor: pointer;
        background: none;
        border: none;
      }
      .hamburger span {
        width: 24px;
        height: 2px;
        background: var(--charcoal);
        border-radius: 2px;
        transition: all 0.3s;
      }
      .hamburger.active span:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
      }
      .hamburger.active span:nth-child(2) {
        opacity: 0;
      }
      .hamburger.active span:nth-child(3) {
        transform: rotate(-45deg) translate(5px, -5px);
      }

      .mobile-menu {
        position: fixed;
        top: 64px;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--white);
        z-index: 99;
        padding: 24px;
        display: none;
        flex-direction: column;
        gap: 8px;
      }
      .mobile-menu.active {
        display: flex;
      }
      .mobile-menu a {
        padding: 16px 20px;
        font-size: 16px;
        border-radius: 12px;
        transition: background 0.3s;
      }
      .mobile-menu a:hover,
      .mobile-menu a.active {
        background: var(--cream);
        color: var(--gold);
      }

      /* Hero */
      .hero {
        padding: 100px 48px 32px;
        background: linear-gradient(180deg, var(--cream) 0%, var(--white) 100%);
        text-align: center;
      }
      .hero-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 16px;
        background: rgba(184, 149, 108, 0.12);
        border-radius: 20px;
        color: var(--gold);
        font-size: 11px;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        margin-bottom: 16px;
      }
      .hero h1 {
        font-size: 36px;
        margin-bottom: 10px;
      }
      .hero h1 span {
        color: var(--gold);
      }
      .hero p {
        color: var(--gray);
        font-size: 15px;
      }

      .main-container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 0 24px 60px;
      }

      /* Chat Box */
      .chat-box {
        background: var(--white);
        border: 1px solid var(--warm);
        border-radius: 16px;
        overflow: hidden;
        margin-bottom: 32px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
      }
      .chat-header {
        padding: 14px 20px;
        background: var(--cream);
        display: flex;
        align-items: center;
        gap: 12px;
        border-bottom: 1px solid var(--warm);
      }
      .chat-header-icon {
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, var(--gold), #d4a574);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }
      .chat-header-icon svg {
        width: 18px;
        height: 18px;
        color: #fff;
      }
      .chat-header-text h3 {
        font-size: 15px;
        font-family: inherit;
        font-weight: 600;
      }
      .chat-header-text p {
        font-size: 11px;
        color: var(--gray);
      }
      .chat-status {
        margin-left: auto;
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 11px;
        color: var(--gray);
      }
      .chat-status::before {
        content: '';
        width: 7px;
        height: 7px;
        background: #4caf50;
        border-radius: 50%;
      }
      .chat-messages {
        height: 100px;
        padding: 16px 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
        background: var(--white);
      }
      .message {
        display: flex;
        gap: 10px;
        max-width: 85%;
      }
      .message.user {
        flex-direction: row-reverse;
        margin-left: auto;
      }
      .message-avatar {
        width: 28px;
        height: 28px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }
      .message.ai .message-avatar {
        background: linear-gradient(135deg, var(--gold), #d4a574);
      }
      .message.ai .message-avatar svg {
        width: 14px;
        height: 14px;
        color: #fff;
      }
      .message.user .message-avatar {
        background: var(--charcoal);
      }
      .message.user .message-avatar svg {
        width: 14px;
        height: 14px;
        color: #fff;
      }
      .message-content {
        padding: 10px 14px;
        border-radius: 12px;
        font-size: 13px;
        line-height: 1.6;
      }
      .message.ai .message-content {
        background: var(--cream);
        border-bottom-left-radius: 4px;
      }
      .message.user .message-content {
        background: var(--charcoal);
        color: #fff;
        border-bottom-right-radius: 4px;
      }
      .welcome-msg {
        text-align: center;
        padding: 16px;
        color: var(--gray);
        font-size: 13px;
      }
      .welcome-msg strong {
        color: var(--charcoal);
        display: block;
        margin-bottom: 4px;
      }
      .chat-input {
        padding: 14px 20px;
        border-top: 1px solid var(--warm);
        background: var(--cream);
        display: flex;
        gap: 10px;
      }
      .chat-input input {
        flex: 1;
        padding: 12px 14px;
        border: 1px solid var(--warm);
        border-radius: 10px;
        font-size: 16px;
        background: var(--white);
      }
      .chat-input input:focus {
        outline: none;
        border-color: var(--gold);
      }
      .chat-input button {
        width: 44px;
        height: 44px;
        background: var(--charcoal);
        border: none;
        border-radius: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s;
        flex-shrink: 0;
      }
      .chat-input button:hover {
        background: var(--gold);
      }
      .chat-input button svg {
        width: 18px;
        height: 18px;
        color: #fff;
      }

      /* Section Title */
      .section-title {
        font-size: 14px;
        color: var(--gray);
        text-transform: uppercase;
        letter-spacing: 1.5px;
        margin-bottom: 16px;
        text-align: center;
      }
      .section-subtitle {
        text-align: center;
        color: var(--gold);
        font-size: 12px;
        margin-top: -12px;
        margin-bottom: 16px;
      }

      /* Category Grid */
      .category-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
        margin-bottom: 24px;
      }
      .category-card {
        background: var(--white);
        border: 2px solid var(--warm);
        border-radius: 16px;
        padding: 20px 12px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
      }
      .category-card:hover {
        border-color: var(--gold);
        transform: translateY(-2px);
      }
      .category-card:active {
        transform: scale(0.98);
      }
      .category-card.has-image {
        border-color: var(--gold);
      }
      .category-card .check-badge {
        position: absolute;
        top: 8px;
        right: 8px;
        width: 22px;
        height: 22px;
        background: var(--gold);
        color: #fff;
        border-radius: 50%;
        font-size: 12px;
        display: none;
        align-items: center;
        justify-content: center;
      }
      .category-card.has-image .check-badge {
        display: flex;
      }
      .category-card .remove-btn {
        position: absolute;
        top: 8px;
        left: 8px;
        width: 24px;
        height: 24px;
        background: rgba(239, 68, 68, 0.9);
        color: #fff;
        border: none;
        border-radius: 50%;
        font-size: 14px;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10;
        transition: all 0.2s;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }
      .category-card.has-image .remove-btn {
        display: flex;
      }
      .category-card .remove-btn:hover {
        background: #dc2626;
        transform: scale(1.1);
      }
      .category-icon {
        font-size: 32px;
        margin-bottom: 8px;
        display: block;
      }
      .category-name {
        font-size: 14px;
        font-weight: 600;
        color: var(--charcoal);
        margin-bottom: 2px;
      }
      .category-desc {
        font-size: 10px;
        color: var(--gray);
      }
      .category-preview {
        width: 100%;
        height: 70px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 6px;
        display: none;
      }
      .category-card.has-image .category-preview {
        display: block;
      }
      .category-card.has-image .category-icon {
        display: none;
      }
      .file-input {
        display: none;
      }

      /* Selected Count Badge */
      .selected-count {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        background: var(--gold);
        color: #fff;
        border-radius: 20px;
        font-size: 13px;
        margin-bottom: 20px;
      }
      .selected-count.hidden {
        display: none;
      }

      /* Theme Selection Section */
      .theme-section {
        background: var(--cream);
        border-radius: 20px;
        padding: 24px;
        margin-bottom: 24px;
      }
      .theme-section-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 16px;
      }
      .theme-section-number {
        width: 24px;
        height: 24px;
        background: var(--charcoal);
        color: #fff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
      }
      .theme-section-title {
        font-size: 15px;
        font-weight: 600;
        color: var(--charcoal);
      }

      /* Style Theme Grid */
      .style-theme-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 10px;
        margin-bottom: 20px;
      }
      .style-theme-card {
        background: var(--white);
        border: 2px solid transparent;
        border-radius: 12px;
        padding: 14px 8px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
      }
      .style-theme-card:hover {
        border-color: var(--gold-light);
        transform: translateY(-2px);
      }
      .style-theme-card.selected {
        border-color: var(--gold);
        background: linear-gradient(180deg, rgba(184, 149, 108, 0.1) 0%, var(--white) 100%);
      }
      .style-theme-icon {
        width: 36px;
        height: 36px;
        margin: 0 auto 8px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }
      .style-theme-card h4 {
        font-size: 12px;
        font-weight: 600;
        margin-bottom: 2px;
        font-family: inherit;
      }
      .style-theme-card p {
        font-size: 9px;
        color: var(--gray);
        line-height: 1.3;
      }
      .style-modern .style-theme-icon { background: #f5f5f5; }
      .style-scandi .style-theme-icon { background: #e8f0e8; }
      .style-industrial .style-theme-icon { background: #e5e5e5; }
      .style-classic .style-theme-icon { background: #f5ebe0; }
      .style-luxury .style-theme-icon { background: #1a1a1a; color: #d4af37; }

      /* Selected Theme Summary */
      .theme-summary {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 12px 16px;
        background: var(--white);
        border-radius: 12px;
        margin-top: 16px;
      }
      .theme-summary-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .theme-summary-label {
        font-size: 11px;
        color: var(--gray);
      }
      .theme-summary-value {
        font-size: 13px;
        font-weight: 600;
        color: var(--charcoal);
      }
      @media (max-width: 768px) {
        .style-theme-grid { grid-template-columns: repeat(3, 1fr); }
        .theme-summary { flex-wrap: wrap; gap: 12px; }
      }
      @media (max-width: 480px) {
        .style-theme-grid { grid-template-columns: repeat(2, 1fr); }
        .style-theme-card p { display: none; }
      }

      /* Single Generate Button */
      .generate-section {
        text-align: center;
        margin-bottom: 32px;
      }
      .generate-btn {
        width: 100%;
        max-width: 400px;
        padding: 18px 32px;
        border: none;
        border-radius: 14px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        background: linear-gradient(135deg, var(--gold), var(--gold-light));
        color: #fff;
        box-shadow: 0 4px 20px rgba(184, 149, 108, 0.3);
      }
      .generate-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 28px rgba(184, 149, 108, 0.4);
      }
      .generate-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }
      .generate-btn .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Progress Steps */
      .progress-steps {
        display: none;
        margin-bottom: 24px;
        padding: 20px;
        background: var(--cream);
        border-radius: 16px;
      }
      .progress-steps.active {
        display: block;
      }
      .step-list {
        display: flex;
        justify-content: space-between;
        position: relative;
        margin-bottom: 16px;
      }
      .step-list::before {
        content: '';
        position: absolute;
        top: 15px;
        left: 10%;
        right: 10%;
        height: 2px;
        background: var(--warm);
      }
      .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        position: relative;
        z-index: 1;
      }
      .step-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--warm);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        transition: all 0.3s;
      }
      .step.active .step-icon {
        background: var(--gold);
        color: #fff;
      }
      .step.done .step-icon {
        background: #10b981;
        color: #fff;
      }
      .step-label {
        font-size: 11px;
        color: var(--gray);
        text-align: center;
      }
      .step.active .step-label {
        color: var(--charcoal);
        font-weight: 600;
      }
      .progress-text {
        text-align: center;
        font-size: 13px;
        color: var(--charcoal);
      }

      /* Result Section */
      .result-section {
        background: var(--cream);
        border-radius: 20px;
        padding: 24px;
        min-height: 300px;
      }

      .result-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 12px;
      }
      .result-header h2 {
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .result-header h2 span {
        font-size: 11px;
        padding: 4px 10px;
        background: var(--gold);
        color: #fff;
        border-radius: 10px;
        font-family: sans-serif;
      }
      .result-actions {
        display: flex;
        gap: 8px;
      }
      .result-btn {
        padding: 10px 14px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .result-btn.download {
        background: var(--charcoal);
        color: #fff;
        border: none;
      }
      .result-btn.download:hover {
        background: var(--gold);
      }
      .result-btn.share {
        background: transparent;
        color: var(--charcoal);
        border: 1px solid var(--charcoal);
      }
      .result-btn.share:hover {
        background: var(--charcoal);
        color: #fff;
      }
      .result-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* Page Navigation */
      .page-nav {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        margin-bottom: 20px;
      }
      .page-nav.hidden {
        display: none;
      }
      .page-arrow {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px solid var(--warm);
        background: var(--white);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
      }
      .page-arrow:hover:not(:disabled) {
        background: var(--gold);
        border-color: var(--gold);
        color: #fff;
      }
      .page-arrow:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }
      .page-arrow svg {
        width: 20px;
        height: 20px;
      }
      .page-indicator {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .page-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--warm);
        cursor: pointer;
        transition: all 0.3s;
      }
      .page-dot.active {
        background: var(--gold);
        width: 24px;
        border-radius: 5px;
      }
      .page-dot:hover {
        background: var(--gold);
      }
      .page-info {
        font-size: 14px;
        color: var(--gray);
        min-width: 60px;
        text-align: center;
      }
      .page-info span {
        color: var(--charcoal);
        font-weight: 600;
      }

      /* Result Pages */
      .result-pages {
        position: relative;
        overflow: hidden;
      }
      .result-page {
        display: none;
      }
      .result-page.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .page-category {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: var(--white);
        border-radius: 12px;
        margin-bottom: 16px;
        font-size: 14px;
        font-weight: 600;
        color: var(--charcoal);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      }
      .page-category .icon {
        font-size: 20px;
      }

      .result-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 16px;
      }
      .result-card {
        background: var(--white);
        border-radius: 14px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }
      .result-card-header {
        padding: 10px 14px;
        background: var(--white);
        border-bottom: 1px solid var(--warm);
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .result-card-header .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
      }
      .result-card-header .dot.before {
        background: #ef4444;
      }
      .result-card-header .dot.after {
        background: #10b981;
      }
      .result-card-header span {
        font-size: 11px;
        font-weight: 600;
        color: var(--gray);
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .result-card img {
        width: 100%;
        height: 220px;
        object-fit: cover;
        display: block;
      }

      /* ‚ïê‚ïê‚ïê Ïù∏Ïä§ÌÉÄÍ∑∏Îû® Ïä§ÌÉÄÏùº Ïù¥ÎØ∏ÏßÄ Î∑∞Ïñ¥ + ÌôîÏÇ¥Ìëú ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ‚ïê‚ïê‚ïê */
      .render-image-container {
        background: #fff;
        border-radius: 16px;
        overflow: hidden;
        margin-bottom: 16px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        position: relative;
      }
      .render-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background: #fff;
        border-bottom: 1px solid #eee;
      }
      .render-status {
        font-size: 14px;
        font-weight: 600;
        color: #f59e0b;
        transition: color 0.3s;
      }
      .render-status.closed {
        color: #3b82f6;
      }
      .render-status.open {
        color: #10b981;
      }
      .render-status.original {
        color: #f59e0b;
      }
      .render-hint {
        font-size: 11px;
        color: #999;
      }
      .render-image-wrapper {
        position: relative;
        width: 100%;
        padding-top: 80%;
        background: #fafafa;
        overflow: hidden;
      }
      .render-main-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        transition: opacity 0.2s;
      }

      /* Ï¢åÏö∞ ÌôîÏÇ¥Ìëú Î≤ÑÌäº */
      .nav-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 44px;
        height: 44px;
        background: rgba(255, 255, 255, 0.9);
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: #333;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        transition: all 0.2s;
        z-index: 10;
      }
      .nav-arrow:hover {
        background: #fff;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }
      .nav-arrow.left {
        left: 12px;
      }
      .nav-arrow.right {
        right: 12px;
      }
      .nav-arrow:active {
        transform: translateY(-50%) scale(0.95);
      }

      /* Ïù¥ÎØ∏ÏßÄ Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ (Ï†ê) */
      .image-indicators {
        display: flex;
        justify-content: center;
        gap: 6px;
        padding: 12px;
      }
      .indicator-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #ddd;
        transition: all 0.2s;
        cursor: pointer;
      }
      .indicator-dot.active {
        background: #333;
        width: 20px;
        border-radius: 4px;
      }

      /* Wall Analysis in Result - ÏÉÅÏÑ∏ Î≤ÑÏ†Ñ */
      .wall-analysis-box {
        background: var(--white);
        border-radius: 14px;
        padding: 16px;
        margin-bottom: 16px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }
      .wall-analysis-box h4 {
        font-size: 13px;
        color: var(--gold);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .wall-analysis-box h4 .badge {
        font-size: 10px;
        padding: 2px 8px;
        background: var(--charcoal);
        color: #fff;
        border-radius: 8px;
        font-family: sans-serif;
      }

      .dimension-display {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        margin-bottom: 16px;
        padding: 16px;
        background: linear-gradient(135deg, rgba(184, 149, 108, 0.08), rgba(212, 184, 150, 0.08));
        border-radius: 12px;
      }
      .dimension-item {
        text-align: center;
      }
      .dimension-item .value {
        font-size: 20px;
        font-weight: 700;
        color: var(--charcoal);
      }
      .dimension-item .unit {
        font-size: 11px;
        color: var(--gold);
        font-weight: 600;
      }
      .dimension-item .label {
        font-size: 10px;
        color: var(--gray);
        margin-top: 2px;
      }

      .wall-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 10px;
        margin-bottom: 12px;
      }
      .wall-info-item {
        background: var(--cream);
        padding: 10px 12px;
        border-radius: 10px;
      }
      .wall-info-item .label {
        font-size: 10px;
        color: var(--gray);
        margin-bottom: 4px;
      }
      .wall-info-item .value {
        font-size: 13px;
        font-weight: 600;
        color: var(--charcoal);
      }

      .install-zone {
        background: linear-gradient(90deg, var(--gold), var(--gold-light));
        color: #fff;
        padding: 12px 16px;
        border-radius: 10px;
        margin-bottom: 12px;
      }
      .install-zone .title {
        font-size: 11px;
        opacity: 0.8;
        margin-bottom: 4px;
      }
      .install-zone .dims {
        font-size: 15px;
        font-weight: 700;
      }

      .obstacles-list {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 12px;
      }
      .obstacle-tag {
        padding: 6px 10px;
        background: var(--cream);
        border-radius: 8px;
        font-size: 11px;
        color: var(--charcoal);
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .obstacle-tag.warning {
        background: #fef3c7;
        color: #92400e;
      }

      .wall-features {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .wall-feature {
        padding: 4px 10px;
        background: var(--cream);
        border-radius: 8px;
        font-size: 10px;
        color: var(--gray);
      }
      .wall-feature.detected {
        background: var(--gold);
        color: #fff;
      }

      .bg-refresh-box {
        background: linear-gradient(135deg, #f0fdf4, #dcfce7);
        border: 1px solid #86efac;
        border-radius: 10px;
        padding: 12px;
        margin-top: 12px;
      }
      .bg-refresh-box h5 {
        font-size: 11px;
        color: #166534;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .bg-refresh-item {
        font-size: 11px;
        color: #15803d;
        padding: 4px 0;
      }

      .result-analysis {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .analysis-card {
        background: var(--white);
        border-radius: 12px;
        padding: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      }
      .analysis-card h4 {
        font-size: 12px;
        color: var(--gold);
        margin-bottom: 6px;
        display: flex;
        align-items: center;
        gap: 6px;
        font-family: inherit;
      }
      .analysis-card p {
        font-size: 12px;
        color: var(--charcoal);
        line-height: 1.6;
      }

      /* Placeholder & Loading */
      .result-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 60px 20px;
        color: var(--gray);
      }
      .result-placeholder .icon {
        font-size: 56px;
        margin-bottom: 16px;
        opacity: 0.4;
      }
      .result-placeholder h3 {
        font-size: 17px;
        color: var(--charcoal);
        margin-bottom: 8px;
        font-family: inherit;
      }
      .result-placeholder p {
        font-size: 13px;
        max-width: 300px;
      }
      .result-placeholder.hidden {
        display: none;
      }

      .result-loading {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 60px 20px;
        text-align: center;
      }
      .result-loading.active {
        display: flex;
      }
      .result-loading .spinner {
        width: 48px;
        height: 48px;
        border: 3px solid var(--warm);
        border-top-color: var(--gold);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }
      .result-loading h3 {
        font-size: 17px;
        color: var(--charcoal);
        margin-bottom: 8px;
      }
      .result-loading p {
        font-size: 13px;
        color: var(--gray);
      }

      /* Footer */
      .footer {
        padding: 48px;
        background: var(--charcoal);
        color: #fff;
        margin-top: 60px;
      }
      .footer-content {
        max-width: 1100px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .footer-brand {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .footer-brand svg {
        width: 24px;
        height: 24px;
      }
      .footer-brand span {
        font-family: 'Playfair Display', serif;
        font-size: 18px;
      }
      .footer-links {
        display: flex;
        gap: 24px;
      }
      .footer-links a {
        color: rgba(255, 255, 255, 0.6);
        font-size: 13px;
        transition: color 0.3s;
      }
      .footer-links a:hover {
        color: #fff;
      }
      .footer-copy {
        text-align: center;
        margin-top: 24px;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 11px;
        color: rgba(255, 255, 255, 0.4);
      }

      /* Toast */
      .toast {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: var(--charcoal);
        color: #fff;
        padding: 14px 24px;
        border-radius: 12px;
        font-size: 14px;
        z-index: 1000;
        transition: transform 0.3s;
        max-width: 90%;
      }
      .toast.show {
        transform: translateX(-50%) translateY(0);
      }
      .toast.success {
        background: #10b981;
      }
      .toast.error {
        background: #ef4444;
      }

      /* Responsive */
      @media (max-width: 1024px) {
        .nav {
          padding: 0 32px;
        }
        .hero {
          padding: 100px 32px 28px;
        }
        .main-container {
          padding: 0 20px 50px;
        }
      }

      @media (max-width: 768px) {
        .nav {
          padding: 0 16px;
          height: 64px;
        }
        .nav-logo span {
          font-size: 20px;
        }
        .nav-menu {
          display: none;
        }
        .hamburger {
          display: flex;
        }

        .hero {
          padding: 84px 16px 20px;
        }
        .hero h1 {
          font-size: 28px;
        }
        .hero p {
          font-size: 14px;
        }

        .main-container {
          padding: 0 12px 40px;
        }

        .chat-box {
          margin-bottom: 20px;
        }
        .chat-messages {
          height: 80px;
        }

        .category-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
          margin-bottom: 20px;
        }
        .category-card {
          padding: 14px 10px;
        }
        .category-icon {
          font-size: 26px;
        }
        .category-name {
          font-size: 13px;
        }
        .category-desc {
          font-size: 9px;
        }
        .category-preview {
          height: 60px;
        }

        .style-selector {
          gap: 8px;
          overflow-x: auto;
          flex-wrap: nowrap;
          justify-content: flex-start;
          padding: 0 12px 8px;
          -webkit-overflow-scrolling: touch;
        }
        .style-chip {
          padding: 8px 14px;
          font-size: 12px;
          flex-shrink: 0;
        }

        .generate-btn {
          padding: 16px 24px;
          font-size: 15px;
        }

        .step-label {
          font-size: 10px;
        }

        .result-section {
          padding: 16px;
        }
        .result-grid {
          grid-template-columns: 1fr;
        }
        .result-card img {
          height: 180px;
        }
        .result-analysis {
          grid-template-columns: 1fr;
        }
        .wall-info-grid {
          grid-template-columns: 1fr 1fr;
        }

        .page-nav {
          gap: 8px;
        }
        .page-arrow {
          width: 36px;
          height: 36px;
        }

        .footer {
          padding: 32px 16px;
        }
        .footer-content {
          flex-direction: column;
          gap: 20px;
          text-align: center;
        }
        .footer-links {
          flex-wrap: wrap;
          justify-content: center;
        }
      }

      @media (max-width: 480px) {
        .nav {
          height: 56px;
        }
        .hero {
          padding: 72px 12px 16px;
        }
        .hero h1 {
          font-size: 24px;
        }
        .category-grid {
          gap: 8px;
        }
        .category-icon {
          font-size: 22px;
        }
        .category-name {
          font-size: 12px;
        }
        .category-desc {
          display: none;
        }
        .category-preview {
          height: 50px;
        }
        .result-card img {
          height: 150px;
        }
        .wall-info-grid {
          grid-template-columns: 1fr;
        }
      }

      @media (hover: none) {
        .category-card:hover {
          transform: none;
        }
        .generate-btn:hover:not(:disabled) {
          transform: none;
        }
      }

      @supports (padding: max(0px)) {
        .nav {
          padding-left: max(16px, env(safe-area-inset-left));
          padding-right: max(16px, env(safe-area-inset-right));
        }
        .main-container {
          padding-left: max(12px, env(safe-area-inset-left));
          padding-right: max(12px, env(safe-area-inset-right));
        }
        .toast {
          bottom: max(24px, env(safe-area-inset-bottom));
        }
      }
    </style>
  </head>
  <body>
    <!-- SVG Symbols -->
    <svg style="display: none">
      <symbol id="icon-logo" viewBox="0 0 40 40">
        <path d="M20 4L4 12v16l16 8 16-8V12L20 4zm0 4l12 6-12 6-12-6 12-6zm-12 10l12 6 12-6v8l-12 6-12-6v-8z" />
      </symbol>
      <symbol id="icon-ai" viewBox="0 0 24 24">
        <path
          fill="currentColor"
          d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13A2.5 2.5 0 0 0 5 15.5 2.5 2.5 0 0 0 7.5 18a2.5 2.5 0 0 0 2.5-2.5A2.5 2.5 0 0 0 7.5 13m9 0a2.5 2.5 0 0 0-2.5 2.5 2.5 2.5 0 0 0 2.5 2.5 2.5 2.5 0 0 0 2.5-2.5 2.5 2.5 0 0 0-2.5-2.5z"
        />
      </symbol>
      <symbol id="icon-user" viewBox="0 0 24 24">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
        <circle cx="12" cy="7" r="4" />
      </symbol>
      <symbol id="icon-send" viewBox="0 0 24 24"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" /></symbol>
      <symbol id="icon-sparkle" viewBox="0 0 24 24">
        <path d="M12 2l2.4 7.2L22 12l-7.6 2.8L12 22l-2.4-7.2L2 12l7.6-2.8L12 2z" />
      </symbol>
      <symbol id="icon-download" viewBox="0 0 24 24">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />
      </symbol>
      <symbol id="icon-share" viewBox="0 0 24 24">
        <circle cx="18" cy="5" r="3" />
        <circle cx="6" cy="12" r="3" />
        <circle cx="18" cy="19" r="3" />
        <path d="m8.59 13.51 6.83 3.98M15.41 6.51l-6.82 3.98" />
      </symbol>
      <symbol id="icon-chevron-left" viewBox="0 0 24 24">
        <path d="m15 18-6-6 6-6" fill="none" stroke="currentColor" stroke-width="2" />
      </symbol>
      <symbol id="icon-chevron-right" viewBox="0 0 24 24">
        <path d="m9 18 6-6-6-6" fill="none" stroke="currentColor" stroke-width="2" />
      </symbol>
    </svg>

    <!-- Navigation -->
    <nav class="nav">
      <a href="index.html" class="nav-logo">
        <svg viewBox="0 0 40 40" fill="currentColor">
          <path d="M20 4L4 12v16l16 8 16-8V12L20 4zm0 4l12 6-12 6-12-6 12-6zm-12 10l12 6 12-6v8l-12 6-12-6v-8z" />
        </svg>
        <span>Îã§Îã¥</span>
      </a>
      <div class="nav-menu">
        <a href="index.html">Ìôà</a>
        <a href="ai-design.html" class="active">AI ÏÑ§Í≥Ñ</a>
        <a href="consultation.html">ÏÉÅÎã¥ Ïã†Ï≤≠</a>
      </div>
      <div class="nav-icons">
        <!-- ÎπÑÎ°úÍ∑∏Ïù∏ ÏÉÅÌÉú -->
        <a href="login.html" id="loginLink" class="login-btn">Î°úÍ∑∏Ïù∏</a>
        <!-- Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú -->
        <div class="user-menu" id="userMenu" style="display: none">
          <button class="user-btn">
            <div class="user-avatar" id="navUserAvatar">?</div>
            <span class="user-name" id="navUserName">ÏÇ¨Ïö©Ïûê</span>
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 9l6 6 6-6" />
            </svg>
          </button>
          <div class="user-dropdown">
            <a href="mypage.html"
              ><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                <circle cx="12" cy="7" r="4" /></svg
              >ÎßàÏù¥ÌéòÏù¥ÏßÄ</a
            >
            <a href="my-designs.html"
              ><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" /></svg
              >ÎÇ¥ ÏÑ§Í≥Ñ</a
            >
            <button onclick="logout()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                <polyline points="16 17 21 12 16 7" />
                <line x1="21" y1="12" x2="9" y2="12" /></svg
              >Î°úÍ∑∏ÏïÑÏõÉ
            </button>
          </div>
        </div>
        <button class="hamburger" onclick="toggleMobileMenu()" aria-label="Î©îÎâ¥">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
      <a href="index.html">Ìôà</a>
      <a href="ai-design.html" class="active" style="background: var(--cream)">AI ÏÑ§Í≥Ñ</a>
      <a href="consultation.html">ÏÉÅÎã¥ Ïã†Ï≤≠</a>
      <a href="mypage.html">ÎßàÏù¥ÌéòÏù¥ÏßÄ</a>
      <a href="my-designs.html">ÎÇ¥ ÏÑ§Í≥Ñ</a>
      <a
        href="login.html"
        id="mobileLoginLink"
        style="background: var(--charcoal); color: #fff; text-align: center; margin-top: 16px"
        >Î°úÍ∑∏Ïù∏ / ÌöåÏõêÍ∞ÄÏûÖ</a
      >
      <a
        href="#"
        id="mobileLogoutLink"
        onclick="
          logout();
          return false;
        "
        style="
          display: none;
          color: var(--gray);
          margin-top: 16px;
          border-top: 1px solid var(--warm);
          padding-top: 24px;
        "
        >Î°úÍ∑∏ÏïÑÏõÉ</a
      >
    </div>

    <!-- Hero -->
    <section class="hero">
      <div class="hero-badge">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
          <use href="#icon-sparkle" />
        </svg>
        AI-Powered Design
      </div>
      <h1>AI <span>ÏÑ§Í≥Ñ</span> ÏãúÏä§ÌÖú</h1>
      <p>ÏÇ¨ÏßÑ Ìïú Ïû•ÏúºÎ°ú ÎßûÏ∂§ Í∞ÄÍµ¨Î•º ÎîîÏûêÏù∏ÌïòÏÑ∏Ïöî</p>
    </section>

    <!-- Main Container -->
    <main class="main-container">
      <!-- AI Chat Box -->
      <div class="chat-box">
        <div class="chat-header">
          <div class="chat-header-icon">
            <svg><use href="#icon-ai" /></svg>
          </div>
          <div class="chat-header-text">
            <h3>Îã§Îã¥ AI ÏÑ§Í≥ÑÏÇ¨</h3>
            <p>ÎßûÏ∂§ Í∞ÄÍµ¨ ÏÑ§Í≥Ñ Ï†ÑÎ¨∏ AI</p>
          </div>
          <div class="chat-status">Ïò®ÎùºÏù∏</div>
        </div>
        <div class="chat-messages" id="chatMessages">
          <div class="welcome-msg">
            <strong>üëã ÏïàÎÖïÌïòÏÑ∏Ïöî!</strong>
            Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌïòÍ≥† ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.
          </div>
        </div>
        <div class="chat-input">
          <input
            type="text"
            id="messageInput"
            placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."
            onkeydown="if (event.key === 'Enter') sendMessage();"
          />
          <button onclick="sendMessage()" aria-label="Ï†ÑÏÜ°">
            <svg fill="none" stroke="currentColor" stroke-width="2"><use href="#icon-send" /></svg>
          </button>
        </div>
      </div>

      <!-- Category Grid -->
      <p class="section-title">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù</p>
      <p class="section-subtitle">üí° Ïó¨Îü¨ Í∞ú ÏÑ†ÌÉù Í∞ÄÎä• - ÌÅ¥Î¶≠ÌïòÏó¨ ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú</p>

      <div style="text-align: center">
        <div class="selected-count hidden" id="selectedCount">üì∑ <span>0</span>Í∞ú Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìúÎê®</div>
      </div>

      <div class="category-grid">
        <div class="category-card" data-category="sink" onclick="selectCategory('sink')">
          <button class="remove-btn" onclick="removeImage('sink', event)" title="ÏÇ≠Ï†ú">‚úï</button>
          <div class="check-badge">‚úì</div>
          <img class="category-preview" id="preview-sink" src="" alt="" />
          <span class="category-icon">üç≥</span>
          <div class="category-name">Ïã±ÌÅ¨ÎåÄ</div>
          <div class="category-desc">Ï£ºÎ∞© Ïã±ÌÅ¨ÎåÄ & ÏÉÅÌïòÎ∂ÄÏû•</div>
        </div>
        <div class="category-card" data-category="wardrobe" onclick="selectCategory('wardrobe')">
          <button class="remove-btn" onclick="removeImage('wardrobe', event)" title="ÏÇ≠Ï†ú">‚úï</button>
          <div class="check-badge">‚úì</div>
          <img class="category-preview" id="preview-wardrobe" src="" alt="" />
          <span class="category-icon">üëî</span>
          <div class="category-name">Î∂ôÎ∞ïÏù¥Ïû•</div>
          <div class="category-desc">Ïò∑Ïû• & ÏàòÎÇ© ÏãúÏä§ÌÖú</div>
        </div>
        <div class="category-card" data-category="fridge" onclick="selectCategory('fridge')">
          <button class="remove-btn" onclick="removeImage('fridge', event)" title="ÏÇ≠Ï†ú">‚úï</button>
          <div class="check-badge">‚úì</div>
          <img class="category-preview" id="preview-fridge" src="" alt="" />
          <span class="category-icon">üßä</span>
          <div class="category-name">ÎÉâÏû•Í≥†Ïû•</div>
          <div class="category-desc">ÎÉâÏû•Í≥†Ïû• & ÌÇ§ÌÅ∞Ïû•</div>
        </div>
        <div class="category-card" data-category="vanity" onclick="selectCategory('vanity')">
          <button class="remove-btn" onclick="removeImage('vanity', event)" title="ÏÇ≠Ï†ú">‚úï</button>
          <div class="check-badge">‚úì</div>
          <img class="category-preview" id="preview-vanity" src="" alt="" />
          <span class="category-icon">üíÑ</span>
          <div class="category-name">ÌôîÏû•ÎåÄ</div>
          <div class="category-desc">ÎìúÎ†àÏÑú & ÌôîÏû•ÎåÄ</div>
        </div>
        <div class="category-card" data-category="shoe" onclick="selectCategory('shoe')">
          <button class="remove-btn" onclick="removeImage('shoe', event)" title="ÏÇ≠Ï†ú">‚úï</button>
          <div class="check-badge">‚úì</div>
          <img class="category-preview" id="preview-shoe" src="" alt="" />
          <span class="category-icon">üëü</span>
          <div class="category-name">Ïã†Î∞úÏû•</div>
          <div class="category-desc">ÌòÑÍ¥Ä Ïã†Î∞úÏû• & ÏàòÎÇ©</div>
        </div>
        <div class="category-card" data-category="storage" onclick="selectCategory('storage')">
          <button class="remove-btn" onclick="removeImage('storage', event)" title="ÏÇ≠Ï†ú">‚úï</button>
          <div class="check-badge">‚úì</div>
          <img class="category-preview" id="preview-storage" src="" alt="" />
          <span class="category-icon">üì¶</span>
          <div class="category-name">ÏûêÏú† ÏàòÎÇ©Ïû•</div>
          <div class="category-desc">Îã§Ïö©ÎèÑ ÏàòÎÇ© Í∞ÄÍµ¨</div>
        </div>
      </div>

      <!-- Hidden File Inputs -->
      <input type="file" class="file-input" id="file-sink" accept="image/*" onchange="handleFileUpload('sink', this)" />
      <input
        type="file"
        class="file-input"
        id="file-wardrobe"
        accept="image/*"
        onchange="handleFileUpload('wardrobe', this)"
      />
      <input
        type="file"
        class="file-input"
        id="file-fridge"
        accept="image/*"
        onchange="handleFileUpload('fridge', this)"
      />
      <input
        type="file"
        class="file-input"
        id="file-vanity"
        accept="image/*"
        onchange="handleFileUpload('vanity', this)"
      />
      <input type="file" class="file-input" id="file-shoe" accept="image/*" onchange="handleFileUpload('shoe', this)" />
      <input
        type="file"
        class="file-input"
        id="file-storage"
        accept="image/*"
        onchange="handleFileUpload('storage', this)"
      />

      <!-- Theme Selection Section -->
      <div class="theme-section">
        <!-- Style Theme -->
        <div class="theme-section-header">
          <span class="theme-section-number">1</span>
          <span class="theme-section-title">Ïä§ÌÉÄÏùº ÌÖåÎßà</span>
        </div>
        <div class="style-theme-grid">
          <div class="style-theme-card style-modern selected" data-style="modern-minimal" onclick="selectStyleTheme(this)">
            <div class="style-theme-icon">‚óªÔ∏è</div>
            <h4>Î™®Îçò ÎØ∏ÎãàÎ©Ä</h4>
            <p>ÍπîÎÅîÌïòÍ≥† ÌòÑÎåÄÏ†Å</p>
          </div>
          <div class="style-theme-card style-scandi" data-style="scandinavian" onclick="selectStyleTheme(this)">
            <div class="style-theme-icon">üå≤</div>
            <h4>Ïä§Ïπ∏ÎîîÎÇòÎπÑÏïà</h4>
            <p>Îî∞ÎúªÌïú ÏõêÎ™©</p>
          </div>
          <div class="style-theme-card style-industrial" data-style="industrial" onclick="selectStyleTheme(this)">
            <div class="style-theme-icon">‚öôÔ∏è</div>
            <h4>Ïù∏ÎçîÏä§Ìä∏Î¶¨Ïñº</h4>
            <p>ÎπàÌã∞ÏßÄ Î©îÌÉà</p>
          </div>
          <div class="style-theme-card style-classic" data-style="classic" onclick="selectStyleTheme(this)">
            <div class="style-theme-icon">üèõÔ∏è</div>
            <h4>ÌÅ¥ÎûòÏãù</h4>
            <p>Ïö∞ÏïÑÌïú Ï†ÑÌÜµ</p>
          </div>
          <div class="style-theme-card style-luxury" data-style="luxury" onclick="selectStyleTheme(this)">
            <div class="style-theme-icon">‚≠ê</div>
            <h4>Îü≠ÏÖîÎ¶¨</h4>
            <p>Í≥†Í∏âÏä§Îü¨Ïö¥</p>
          </div>
        </div>

        <!-- Selection Summary -->
        <div class="theme-summary">
          <div class="theme-summary-item">
            <div>
              <div class="theme-summary-label">ÏÑ†ÌÉùÎêú Ïä§ÌÉÄÏùº</div>
              <div class="theme-summary-value" id="selectedStyleName">Î™®Îçò ÎØ∏ÎãàÎ©Ä</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Single Generate Button -->
      <div class="generate-section">
        <button class="generate-btn" id="generateBtn" onclick="startGeneration()" disabled>
          ‚ú® AI ÎîîÏûêÏù∏ ÏÉùÏÑ±ÌïòÍ∏∞
        </button>
      </div>

      <!-- Progress Steps -->
      <div class="progress-steps" id="progressSteps">
        <div class="step-list">
          <div class="step" id="step1">
            <div class="step-icon">1</div>
            <div class="step-label">Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù</div>
          </div>
          <div class="step" id="step2">
            <div class="step-icon">2</div>
            <div class="step-label">Î≤Ω Íµ¨Ï°∞ ÌååÏïÖ</div>
          </div>
          <div class="step" id="step3">
            <div class="step-icon">3</div>
            <div class="step-label">ÎîîÏûêÏù∏ ÏÉùÏÑ±</div>
          </div>
          <div class="step" id="step4">
            <div class="step-icon">4</div>
            <div class="step-label">ÏôÑÎ£å</div>
          </div>
        </div>
        <p class="progress-text" id="progressText">Ï§ÄÎπÑ Ï§ë...</p>
      </div>

      <!-- Result Section -->
      <section class="result-section">
        <div class="result-header">
          <h2>üñºÔ∏è Î¶¨ÎîîÏûêÏù∏ Í≤∞Í≥º <span>AI Generated</span></h2>
          <div class="result-actions">
            <button class="result-btn download" id="downloadBtn" onclick="downloadCurrentImage()" disabled>
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <use href="#icon-download" />
              </svg>
              Îã§Ïö¥Î°úÎìú
            </button>
            <button class="result-btn share" id="shareBtn" onclick="shareResult()" disabled>
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <use href="#icon-share" />
              </svg>
              Í≥µÏú†
            </button>
          </div>
        </div>

        <!-- Page Navigation -->
        <div class="page-nav hidden" id="pageNav">
          <button class="page-arrow" id="prevPage" onclick="changePage(-1)">
            <svg><use href="#icon-chevron-left" /></svg>
          </button>
          <div class="page-indicator" id="pageIndicator"></div>
          <div class="page-info"><span id="currentPage">1</span> / <span id="totalPages">1</span></div>
          <button class="page-arrow" id="nextPage" onclick="changePage(1)">
            <svg><use href="#icon-chevron-right" /></svg>
          </button>
        </div>

        <!-- Placeholder -->
        <div class="result-placeholder" id="resultPlaceholder">
          <div class="icon">üé®</div>
          <h3>ÎîîÏûêÏù∏ Í≤∞Í≥ºÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</h3>
          <p>Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌïòÍ≥† ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌïú ÌõÑ ÏÉùÏÑ± Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî</p>
        </div>

        <!-- Loading -->
        <div class="result-loading" id="resultLoading">
          <div class="spinner"></div>
          <h3 id="loadingTitle">AIÍ∞Ä Î∂ÑÏÑù Ï§ë...</h3>
          <p id="loadingText">Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî</p>
        </div>

        <!-- Result Pages Container -->
        <div class="result-pages" id="resultPages"></div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <a href="index.html" class="footer-brand">
          <svg fill="currentColor"><use href="#icon-logo" /></svg>
          <span>Îã§Îã¥</span>
        </a>
        <div class="footer-links">
          <a href="index.html">Ìôà</a>
          <a href="#">Ï†úÌíà</a>
          <a href="#">ÏãúÍ≥µÏÇ¨Î°Ä</a>
          <a href="#">ÏáºÎ£∏</a>
          <a href="#">Í≥†Í∞ùÏÑºÌÑ∞</a>
        </div>
      </div>
      <p class="footer-copy">¬© 2024 Îã§Îã¥Í∞ÄÍµ¨. All rights reserved.</p>
    </footer>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Supabase Ï¥àÍ∏∞Ìôî Î∞è Ïù∏Ï¶ù ÏÉÅÌÉú ÌôïÏù∏ - config.jsÏóêÏÑú Í∞ÄÏ†∏Ïò¥
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      let supabaseClient = null;

      (async function initAuth() {
        try {
          if (typeof window.supabase !== 'undefined' && window.DADAM_CONFIG?.supabase) {
            const { url, anonKey } = window.DADAM_CONFIG.supabase;
            supabaseClient = window.supabase.createClient(url, anonKey);
            const {
              data: { session },
            } = await supabaseClient.auth.getSession();

            if (session) {
              const user = session.user;
              const meta = user.user_metadata || {};
              const tier = meta.tier || 'standard';

              // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÌëúÏãú
              document.getElementById('loginLink').style.display = 'none';
              document.getElementById('userMenu').style.display = 'block';
              document.getElementById('mobileLoginLink').style.display = 'none';
              document.getElementById('mobileLogoutLink').style.display = 'block';

              const name = meta.name || meta.full_name || user.email.split('@')[0];
              document.getElementById('navUserAvatar').textContent = name.charAt(0).toUpperCase();
              document.getElementById('navUserName').textContent = name;

              // Expert ÎòêÎäî Business Îì±Í∏âÏùÄ ÏÉÅÏÑ∏ ÏÑ§Í≥Ñ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
              if (tier === 'expert' || tier === 'business') {
                window.location.href = 'detaildesign.html';
                return;
              }
            }
          }
        } catch (e) {
          console.log('Auth check error:', e.message);
        }
      })();

      // Î°úÍ∑∏ÏïÑÏõÉ Ìï®Ïàò
      async function logout() {
        if (!supabaseClient) return;
        await supabaseClient.auth.signOut();
        window.location.href = 'index.html';
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // API URLs (Cloudflare Worker ÌîÑÎ°ùÏãú Í≤ΩÏú† - CORS Ìï¥Í≤∞!)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      const N8N_CHAT_URL = 'https://dadam.app.n8n.cloud/webhook/chat';

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Ï±ÑÌåÖ Í∏∞Î°ù Ï†ÄÏû•/Î∂àÎü¨Ïò§Í∏∞ (Supabase)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

      // ÏÑ∏ÏÖò ID ÏÉùÏÑ±/Í∞ÄÏ†∏Ïò§Í∏∞ (ÎπÑÎ°úÍ∑∏Ïù∏ ÏÇ¨Ïö©ÏûêÏö©)
      function getChatSessionId() {
        let sessionId = sessionStorage.getItem('chat_session_id');
        if (!sessionId) {
          sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
          sessionStorage.setItem('chat_session_id', sessionId);
        }
        return sessionId;
      }

      // Î©îÏãúÏßÄ Ï†ÄÏû•
      async function saveChatMessage(content, role) {
        if (!supabaseClient) return;

        try {
          const { data: { session } } = await supabaseClient.auth.getSession();
          const userId = session?.user?.id || null;
          const sessionId = userId ? null : getChatSessionId();

          await supabaseClient.from('chat_messages').insert({
            user_id: userId,
            session_id: sessionId,
            role: role,
            content: content,
            page_source: 'ai-design'
          });
        } catch (error) {
          console.log('Î©îÏãúÏßÄ Ï†ÄÏû• Ïã§Ìå®:', error.message);
        }
      }

      // ÎåÄÌôî Í∏∞Î°ù Î∂àÎü¨Ïò§Í∏∞
      async function loadChatHistory() {
        if (!supabaseClient) return;

        try {
          const { data: { session } } = await supabaseClient.auth.getSession();
          const userId = session?.user?.id;
          const sessionId = getChatSessionId();

          let query = supabaseClient
            .from('chat_messages')
            .select('*')
            .eq('page_source', 'ai-design')
            .order('created_at', { ascending: true })
            .limit(50);

          if (userId) {
            query = query.eq('user_id', userId);
          } else {
            query = query.eq('session_id', sessionId);
          }

          const { data, error } = await query;

          if (error) throw error;

          if (data && data.length > 0) {
            const chatMessages = document.getElementById('chatMessages');
            const welcome = chatMessages.querySelector('.welcome-msg');
            if (welcome) welcome.remove();

            data.forEach(msg => {
              addChatMessage(msg.content, msg.role === 'user', false);
            });
          }
        } catch (error) {
          console.log('ÎåÄÌôî Í∏∞Î°ù Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:', error.message);
        }
      }

      // ÌéòÏù¥ÏßÄ Î°úÎìú ÌõÑ ÎåÄÌôî Í∏∞Î°ù Î∂àÎü¨Ïò§Í∏∞
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
          if (supabaseClient) {
            loadChatHistory();
          }
        }, 500);
      });
      // ÌîÑÎ°úÎçïÏÖò API URL (n8n ÌÅ¥ÎùºÏö∞Îìú)
      const N8N_INTERIOR_URL = 'https://dadam.app.n8n.cloud/webhook/dadam-interior-v4';

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // ÏÉÅÏÑ∏ Í≥µÍ∞Ñ Î∂ÑÏÑù ÌîÑÎ°¨ÌîÑÌä∏ (Claude VisionÏö©)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      const DETAILED_ANALYSIS_PROMPT = `ÎãπÏã†ÏùÄ Ï†ÑÎ¨∏ 3D Í±¥Ï∂ï Î™®Îç∏Îü¨Ïù¥Ïûê Ïù∏ÌÖåÎ¶¨Ïñ¥ Ï∏°Îüâ Ï†ÑÎ¨∏Í∞ÄÏûÖÎãàÎã§. 
Ïù¥ Í≥µÍ∞Ñ Ïù¥ÎØ∏ÏßÄÎ•º Ï†ïÎ∞Ä Î∂ÑÏÑùÌïòÏó¨ ÎßûÏ∂§ Í∞ÄÍµ¨ ÏÑ§ÏπòÎ•º ÏúÑÌïú ÏÉÅÏÑ∏ Ï†ïÎ≥¥Î•º Ï∂îÏ∂úÌïòÏÑ∏Ïöî.

## Î∂ÑÏÑù ÏßÄÏπ®

### 1. Í∏∞Ï§Ä ÏÇ¨Î¨ºÏùÑ ÌÜµÌïú ÏπòÏàò Ï∂îÏ†ï
- ÌëúÏ§Ä Î¨∏ ÎÜíÏù¥: 2,100mm, Ìè≠: 900mm
- ÌëúÏ§Ä Ï∞ΩÎ¨∏ ÎÜíÏù¥: 1,200mm
- ÌëúÏ§Ä ÏΩòÏÑºÌä∏ ÎÜíÏù¥: Î∞îÎã•ÏóêÏÑú 300mm
- ÌëúÏ§Ä Ïä§ÏúÑÏπò ÎÜíÏù¥: Î∞îÎã•ÏóêÏÑú 1,200mm
- ÌëúÏ§Ä Ï≤úÏû• ÎÜíÏù¥: 2,400mm (ÏïÑÌååÌä∏ Í∏∞Ï§Ä)
- ÏóêÏñ¥Ïª® Ïã§ÎÇ¥Í∏∞ Ìè≠: ÏïΩ 800-1,000mm

### 2. Î∂ÑÏÑù Ìï≠Î™©
- Í∞Å Î≤ΩÎ©¥Ïùò ÏòàÏÉÅ Í∞ÄÎ°ú Í∏∏Ïù¥ (mm Îã®ÏúÑ)
- Ï≤úÏû• ÎÜíÏù¥ Ï∂îÏ†ï
- Ïû•Ïï†Î¨º(Î¨∏, Ï∞ΩÎ¨∏, ÏΩòÏÑºÌä∏, Î∞∞Í¥Ä, ÏóêÏñ¥Ïª® Îì±) Ï†ïÌôïÌïú ÏúÑÏπò
- Í∞ÄÍµ¨ ÏÑ§Ïπò Í∞ÄÎä• ÏòÅÏó≠ (ÏãúÏûëÏ†ê~ÎÅùÏ†ê)
- Î≤ΩÎ©¥ ÏÉÅÌÉú (Î≤ΩÏßÄ ÏÉÅÌÉú, ÏäµÍ∏∞, Í∑†Ïó¥ Îì±)
- Î∞îÎã• Ïû¨Ïßà Î∞è ÏÉÅÌÉú

### 3. JSON ÏùëÎãµ ÌòïÏãù
{
  "space_analysis": {
    "layout_type": "ÏùºÏûêÌòï/„Ñ±ÏûêÌòï/„Ñ∑ÏûêÌòï",
    "estimated_dimensions": {
      "total_width_mm": Ïà´Ïûê,
      "ceiling_height_mm": Ïà´Ïûê,
      "depth_mm": Ïà´Ïûê
    },
    "reference_objects": [
      {"type": "Î¨∏/Ï∞ΩÎ¨∏/ÏΩòÏÑºÌä∏/ÏóêÏñ¥Ïª®", "estimated_size": "Ìè≠xÎÜíÏù¥mm", "position": "Ï¢åÏ∏°/Ï§ëÏïô/Ïö∞Ï∏°"}
    ]
  },
  "walls": [
    {
      "position": "left/front/right",
      "estimated_width_mm": Ïà´Ïûê,
      "installable_zone": {
        "start_mm": ÏãúÏûëÏúÑÏπò,
        "end_mm": ÎÅùÏúÑÏπò,
        "available_width_mm": ÏÑ§ÏπòÍ∞ÄÎä•Ìè≠,
        "max_height_mm": ÏµúÎåÄÎÜíÏù¥
      },
      "obstacles": [
        {"type": "Î¨∏/Ï∞ΩÎ¨∏/ÏΩòÏÑºÌä∏/Î∞∞Í¥Ä", "position_mm": ÏúÑÏπò, "size_mm": "Ìè≠xÎÜíÏù¥", "clearance_required_mm": ÌïÑÏöîÏó¨Ïú†Í≥µÍ∞Ñ}
      ],
      "condition": {
        "wall_state": "ÏñëÌò∏/Î≥¥ÏàòÌïÑÏöî/ÏäµÍ∏∞ÏÜêÏÉÅ",
        "wallpaper": "ÏûàÏùå/ÏóÜÏùå/Ï†úÍ±∞ÏÉÅÌÉú",
        "notes": "ÏÉÅÏÑ∏ Î©îÎ™®"
      }
    }
  ],
  "floor": {
    "material": "ÎßàÎ£®/ÌÉÄÏùº/Ïû•Ìåê",
    "condition": "ÏñëÌò∏/Î≥¥ÏàòÌïÑÏöî",
    "color_tone": "Î∞ùÏùå/Ï§ëÍ∞Ñ/Ïñ¥ÎëêÏõÄ"
  },
  "installation_constraints": {
    "recommended_cabinet_width_mm": Ï∂îÏ≤úÌè≠,
    "recommended_cabinet_height_mm": Ï∂îÏ≤úÎÜíÏù¥,
    "recommended_cabinet_depth_mm": Ï∂îÏ≤úÍπäÏù¥,
    "side_clearance_mm": Ï¢åÏö∞Ïó¨Ïú†,
    "top_clearance_mm": ÏÉÅÎã®Ïó¨Ïú†,
    "avoid_zones": ["ÌîºÌï¥ÏïºÌï† ÏòÅÏó≠ ÏÑ§Î™Ö"]
  },
  "background_condition": {
    "wall_needs_refresh": true/false,
    "floor_needs_refresh": true/false,
    "suggested_wall_style": "ÌôîÏù¥Ìä∏ Î¨¥Í¥ë/Í∑∏Î†àÏù¥ ÌÜ§/Ïö∞Îìú Ìå®ÎÑê Îì±",
    "suggested_floor_style": "Î∞ùÏùÄ ÏõêÎ™©/Ìó§ÎßÅÎ≥∏/Í∑∏Î†àÏù¥ ÌÉÄÏùº Îì±"
  },
  "analysis_confidence": "high/medium/low",
  "additional_notes": "Ï∂îÍ∞Ä Í¥ÄÏ∞∞ ÏÇ¨Ìï≠"
}`;

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // DALL-E Î∞∞Í≤Ω Î≥¥Ï†ï ÌîÑÎ°¨ÌîÑÌä∏ ÏÉùÏÑ±
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function generateDesignPrompt(category, style, wallAnalysis) {
        const info = categoryInfo[category];
        const themeData = styleThemes[style] || styleThemes['modern-minimal'];

        let basePrompt = `[MOST IMPORTANT - READ FIRST]
This is a PHOTO generation task, NOT a technical drawing.
DO NOT ADD ANY TEXT, NUMBERS, DIMENSIONS, OR LABELS.

[TASK: KOREAN INTERIOR DESIGN - PHOTOREALISTIC]
Professional interior design photo of a modern Korean apartment with ${info.name} (${category}) installation.

[STYLE: ${themeData.name}]
${themeData.keywords}
Atmosphere: ${themeData.atmosphere}`;

        // Î∞∞Í≤Ω Î≥¥Ï†ï ÏßÄÏãú
        let backgroundPrompt = `
[BACKGROUND REQUIREMENTS]
- Clean, pristine walls with smooth matte finish
- Fresh, modern wallpaper or paint (light gray or warm white tones)
- Pristine flooring - light oak hardwood or modern laminate
- No visible damage, stains, or imperfections
- Soft natural lighting from windows
- Minimalist, clutter-free space`;

        // Î≤Ω Î∂ÑÏÑù Í≤∞Í≥º Î∞òÏòÅ
        if (wallAnalysis) {
          const dims = wallAnalysis.space_analysis?.estimated_dimensions;
          const constraints = wallAnalysis.installation_constraints;
          const bgCond = wallAnalysis.background_condition;

          if (dims) {
            basePrompt += `\n\n[SPACE DIMENSIONS]\nRoom: ${dims.total_width_mm / 1000}m wide, ${dims.ceiling_height_mm / 1000}m ceiling height.`;
          }

          if (constraints) {
            basePrompt += `\nCabinet: ${constraints.recommended_cabinet_width_mm}mm wide, ${constraints.recommended_cabinet_height_mm}mm tall, ${constraints.recommended_cabinet_depth_mm}mm deep.`;
          }

          if (bgCond?.suggested_wall_style) {
            backgroundPrompt += `\n- Wall style: ${bgCond.suggested_wall_style}`;
          }
          if (bgCond?.suggested_floor_style) {
            backgroundPrompt += `\n- Floor style: ${bgCond.suggested_floor_style}`;
          }
        }

        // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌäπÌôî ÌîÑÎ°¨ÌîÑÌä∏
        const categoryPrompts = {
          sink: `Modern kitchen with sleek built-in cabinets, integrated sink, upper and lower cabinets with hidden handles, LED under-cabinet lighting.`,
          wardrobe: `Floor-to-ceiling built-in wardrobe with sliding doors, hidden handles, internal LED lighting, mix of hanging space and shelves.`,
          fridge: `Tall cabinet unit surrounding refrigerator, pantry storage, clean integration with kitchen design.`,
          vanity: `Elegant vanity area with mirror cabinet, soft lighting, drawer storage, modern minimalist design.`,
          shoe: `Entryway shoe cabinet with ventilation, pull-out shelves, bench seating option, clean modern look.`,
          storage: `Custom storage solution with adjustable shelves, clean doors, organized interior compartments.`,
        };

        const fullPrompt = `${basePrompt}

[FURNITURE DETAILS]
${categoryPrompts[category] || ''}

${backgroundPrompt}

[STYLE DETAILS]
${getStyleDetails(style)}

[STRICTLY FORBIDDEN]
‚ùå NO dimension labels or measurements
‚ùå NO text, numbers, or characters
‚ùå NO watermarks or logos
‚ùå NO people or pets

[OUTPUT]
Ultra-realistic 3D rendering, professional interior photography, 8K quality, perfect lighting, architectural visualization.
Clean photorealistic Korean apartment interior photograph.
Magazine quality, professional lighting.`;

        return fullPrompt;
      }

      function getStyleDetails(style) {
        const styles = {
          'modern-minimal': 'Clean lines, minimalist aesthetic, matte finishes, neutral colors (white, gray, black), hidden hardware, geometric shapes, handleless design, flush surfaces.',
          'scandinavian': 'Light wood tones, white and pastel colors, natural materials, cozy textures, simple functional design, hygge atmosphere, warmth and comfort.',
          'industrial': 'Raw materials, exposed elements, metal accents, dark tones, concrete textures, vintage industrial fixtures, urban loft aesthetic.',
          'classic': 'Traditional design, crown molding, paneled doors, brass hardware, timeless elegance, refined craftsmanship, sophisticated details.',
          'luxury': 'Premium materials, gold/brass accents, rich textures, marble elements, sophisticated lighting, high-end finishes, opulent atmosphere.',
        };
        return styles[style] || styles['modern-minimal'];
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // State
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      const state = {
        selectedStyle: 'modern-minimal',
        selectedStyleName: 'Î™®Îçò ÎØ∏ÎãàÎ©Ä',
        uploadedImages: {},
        results: [],
        currentPage: 0,
      };

      // Ïä§ÌÉÄÏùº ÌÖåÎßà Îç∞Ïù¥ÌÑ∞
      const styleThemes = {
        'modern-minimal': {
          name: 'Î™®Îçò ÎØ∏ÎãàÎ©Ä',
          keywords: 'clean lines, minimal design, hidden handles, matte finish, geometric shapes',
          atmosphere: 'serene, uncluttered, contemporary'
        },
        'scandinavian': {
          name: 'Ïä§Ïπ∏ÎîîÎÇòÎπÑÏïà',
          keywords: 'light wood tones, natural textures, functional design, hygge comfort',
          atmosphere: 'warm, cozy, bright, natural light'
        },
        'industrial': {
          name: 'Ïù∏ÎçîÏä§Ìä∏Î¶¨Ïñº',
          keywords: 'raw materials, metal accents, exposed elements, dark tones, vintage fixtures',
          atmosphere: 'urban, edgy, bold, masculine'
        },
        'classic': {
          name: 'ÌÅ¥ÎûòÏãù',
          keywords: 'traditional design, crown molding, paneled doors, brass hardware, timeless elegance',
          atmosphere: 'sophisticated, refined, traditional'
        },
        'luxury': {
          name: 'Îü≠ÏÖîÎ¶¨',
          keywords: 'premium materials, gold/brass accents, marble, rich textures, high-end finishes',
          atmosphere: 'opulent, glamorous, prestigious'
        }
      };

      const categoryInfo = {
        sink: { name: 'Ïã±ÌÅ¨ÎåÄ', icon: 'üç≥' },
        wardrobe: { name: 'Î∂ôÎ∞ïÏù¥Ïû•', icon: 'üëî' },
        fridge: { name: 'ÎÉâÏû•Í≥†Ïû•', icon: 'üßä' },
        vanity: { name: 'ÌôîÏû•ÎåÄ', icon: 'üíÑ' },
        shoe: { name: 'Ïã†Î∞úÏû•', icon: 'üëü' },
        storage: { name: 'ÏûêÏú† ÏàòÎÇ©Ïû•', icon: 'üì¶' },
      };

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Mobile Menu
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function toggleMobileMenu() {
        const hamburger = document.querySelector('.hamburger');
        const mobileMenu = document.getElementById('mobileMenu');
        hamburger.classList.toggle('active');
        mobileMenu.classList.toggle('active');
        document.body.style.overflow = mobileMenu.classList.contains('active') ? 'hidden' : '';
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Category & File Upload
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function selectCategory(category) {
        document.getElementById(`file-${category}`).click();
      }

      function handleFileUpload(category, input) {
        const file = input.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          const base64Full = e.target.result;
          const base64Data = base64Full.split(',')[1];

          state.uploadedImages[category] = {
            base64: base64Data,
            preview: base64Full,
            type: file.type || 'image/jpeg',
          };

          document.getElementById(`preview-${category}`).src = base64Full;
          document.querySelector(`[data-category="${category}"]`).classList.add('has-image');

          updateSelectedCount();
          updateButtons();

          showToast(`${categoryInfo[category].name} Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÏôÑÎ£å!`, 'success');
          addChatMessage(
            `${categoryInfo[category].icon} ${categoryInfo[category].name} Ïù¥ÎØ∏ÏßÄÍ∞Ä Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.`,
            false
          );
        };
        reader.readAsDataURL(file);
      }

      function updateSelectedCount() {
        const count = Object.keys(state.uploadedImages).length;
        const countEl = document.getElementById('selectedCount');
        countEl.querySelector('span').textContent = count;
        countEl.classList.toggle('hidden', count === 0);
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Remove Uploaded Image
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function removeImage(category, event) {
        event.stopPropagation(); // Ïπ¥Îìú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï†ÑÌåå Î∞©ÏßÄ

        if (!state.uploadedImages[category]) return;

        // stateÏóêÏÑú ÏÇ≠Ï†ú
        delete state.uploadedImages[category];

        // UI ÏóÖÎç∞Ïù¥Ìä∏
        const card = document.querySelector(`[data-category="${category}"]`);
        card.classList.remove('has-image');

        const preview = document.getElementById(`preview-${category}`);
        preview.src = '';

        // ÌååÏùº input Ï¥àÍ∏∞Ìôî
        const fileInput = document.getElementById(`file-${category}`);
        fileInput.value = '';

        updateSelectedCount();
        updateButtons();

        showToast(`${categoryInfo[category].name} Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, 'info');
        addChatMessage(`${categoryInfo[category].icon} ${categoryInfo[category].name} Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, false);
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Style Theme Selection
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function selectStyleTheme(el) {
        document.querySelectorAll('.style-theme-card').forEach((c) => c.classList.remove('selected'));
        el.classList.add('selected');

        const styleKey = el.dataset.style;
        const themeData = styleThemes[styleKey];

        state.selectedStyle = styleKey;
        state.selectedStyleName = themeData?.name || styleKey;

        // Summary ÏóÖÎç∞Ïù¥Ìä∏
        const summaryEl = document.getElementById('selectedStyleName');
        if (summaryEl) summaryEl.textContent = state.selectedStyleName;

        console.log('Style selected:', state.selectedStyle, state.selectedStyleName);
        showToast(`Ïä§ÌÉÄÏùº: ${state.selectedStyleName} ÏÑ†ÌÉùÎê®`, 'success');
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Button State
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function updateButtons() {
        const hasImages = Object.keys(state.uploadedImages).length > 0;
        document.getElementById('generateBtn').disabled = !hasImages;
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Progress Steps
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function updateStep(stepNum, status, text) {
        // status: 'active', 'done', ''
        for (let i = 1; i <= 4; i++) {
          const step = document.getElementById(`step${i}`);
          step.classList.remove('active', 'done');
          if (i < stepNum) step.classList.add('done');
          if (i === stepNum) step.classList.add(status);
        }
        document.getElementById('progressText').textContent = text;
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // MAIN GENERATION FLOW
      // Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ‚Üí Î≤Ω Î∂ÑÏÑù ‚Üí DALL-E3 ÏÉùÏÑ± (Î∂ÑÏÑù Í≤∞Í≥º Î∞òÏòÅ)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      async function startGeneration() {
        const categories = Object.keys(state.uploadedImages);
        if (categories.length === 0) {
          showToast('Ïù¥ÎØ∏ÏßÄÎ•º Î®ºÏ†Ä ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
          return;
        }

        const btn = document.getElementById('generateBtn');
        const progressSteps = document.getElementById('progressSteps');
        const placeholder = document.getElementById('resultPlaceholder');
        const loading = document.getElementById('resultLoading');
        const pagesContainer = document.getElementById('resultPages');

        btn.disabled = true;
        btn.innerHTML = '<div class="spinner"></div> ÏÉùÏÑ± Ï§ë...';
        progressSteps.classList.add('active');
        placeholder.classList.add('hidden');
        pagesContainer.innerHTML = '';
        loading.classList.add('active');

        state.results = [];
        const total = categories.length;

        for (let i = 0; i < categories.length; i++) {
          const category = categories[i];
          const imageData = state.uploadedImages[category];
          const info = categoryInfo[category];

          let wallAnalysis = null;

          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          // STEP 1: Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù ÏãúÏûë
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          updateStep(1, 'active', `${info.icon} ${info.name} Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë... (${i + 1}/${total})`);
          document.getElementById('loadingTitle').textContent = `${info.icon} Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë...`;
          document.getElementById('loadingText').textContent = `${i + 1} / ${total}`;
          await sleep(500);

          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          // STEP 2: Ïä§ÌÉÄÏùº/Ïª¨Îü¨ Ï†ÅÏö© (Î≤Ω Î∂ÑÏÑù ÏÉùÎûµ - ÌÖåÎßà Í∏∞Î∞ò ÏÉùÏÑ±)
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          updateStep(2, 'active', `${info.icon} Ïä§ÌÉÄÏùº Ï†ÅÏö© Ï§ë...`);
          document.getElementById('loadingTitle').textContent = `üé® ÌÖåÎßà Ïä§ÌÉÄÏùº Ï†ÅÏö© Ï§ë...`;
          console.log('Selected Style:', state.selectedStyle);
          await sleep(300);

          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          // STEP 3: DALL-E3 ÎîîÏûêÏù∏ ÏÉùÏÑ± (Î≤Ω Î∂ÑÏÑù Í≤∞Í≥º + Î∞∞Í≤Ω Î≥¥Ï†ï Î∞òÏòÅ)
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          updateStep(3, 'active', `${info.icon} AI ÎîîÏûêÏù∏ ÏÉùÏÑ± Ï§ë...`);
          document.getElementById('loadingTitle').textContent = `‚ú® ÎîîÏûêÏù∏ ÏÉùÏÑ± Ï§ë...`;

          // ÏÉÅÏÑ∏ ÌîÑÎ°¨ÌîÑÌä∏ ÏÉùÏÑ± (Î≤Ω Î∂ÑÏÑù + Î∞∞Í≤Ω Î≥¥Ï†ï Ìè¨Ìï®)
          const designPrompt = generateDesignPrompt(category, state.selectedStyle, wallAnalysis);
          console.log('Design Prompt:', designPrompt);

          try {
            // Ïä§ÌÉÄÏùº Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ
            const themeData = styleThemes[state.selectedStyle] || styleThemes['modern-minimal'];

            const response = await fetch(N8N_INTERIOR_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                room_image: imageData.base64,
                image_type: imageData.type,
                category: category,
                design_style: state.selectedStyle,
                style_name: themeData.name,
                style_keywords: themeData.keywords,
                style_atmosphere: themeData.atmosphere,
                design_prompt: designPrompt,
              }),
            });

            if (!response.ok) throw new Error(`HTTP ${response.status}`);

            let data = await response.json();
            if (Array.isArray(data)) data = data[0];

            console.log('API Response:', data);

            // Ïù¥ÎØ∏ÏßÄ Ï∂îÏ∂ú (Î°úÏª¨ ÏÑúÎ≤Ñ Î∞è n8n ÌòïÏãù Î™®Îëê ÏßÄÏõê)
            let afterImageUrl = '';
            let afterImageUrlOpen = '';

            // Î°úÏª¨ ÏÑúÎ≤Ñ ÌòïÏãù: { generatedImage: { base64, mimeType } }
            if (data.generatedImage && data.generatedImage.base64) {
              const mimeType = data.generatedImage.mimeType || 'image/jpeg';
              afterImageUrl = `data:${mimeType};base64,${data.generatedImage.base64}`;
            }
            // n8n ÌòïÏãù: { generated_image: { closed: { base64 }, open: { base64 } } }
            else if (data.generated_image) {
              // Îã´Ìûå ÎèÑÏñ¥ Ïù¥ÎØ∏ÏßÄ
              if (data.generated_image.closed && data.generated_image.closed.base64) {
                const mimeType = data.generated_image.closed.mime_type || 'image/png';
                afterImageUrl = `data:${mimeType};base64,${data.generated_image.closed.base64}`;
              }
              // Ïù¥Ï†Ñ ÌòïÏãù Ìò∏Ìôò
              else if (data.generated_image.base64) {
                const mimeType = data.generated_image.mime_type || 'image/png';
                afterImageUrl = `data:${mimeType};base64,${data.generated_image.base64}`;
              } else if (data.generated_image.url) {
                afterImageUrl = data.generated_image.url;
              }

              // Ïó¥Î¶∞ ÎèÑÏñ¥ Ïù¥ÎØ∏ÏßÄ
              if (data.generated_image.open && data.generated_image.open.base64) {
                const mimeType = data.generated_image.open.mime_type || 'image/png';
                afterImageUrlOpen = `data:${mimeType};base64,${data.generated_image.open.base64}`;
              }
            }

            // Î∂ÑÏÑù Í≤∞Í≥º Ìè¨Îß∑ÌåÖ
            let analysisText = data.message || `${themeData.name || state.selectedStyle} Ïä§ÌÉÄÏùº Ï†ÅÏö©`;
            if (data.rag_rules_count) {
              analysisText = `RAG Í∑úÏπô ${data.rag_rules_count}Í∞ú Ï†ÅÏö© | ${themeData.name} Ïä§ÌÉÄÏùº`;
            }

            // Ï†úÏïà ÌÖçÏä§Ìä∏
            let suggestionText = `${info.name} - ÎèôÏùº Ï†úÌíà ÎèÑÏñ¥ Ïó¥Î¶º/Îã´Ìûò`;

            state.results.push({
              category,
              beforeUrl: imageData.preview,
              afterUrl: afterImageUrl,
              afterUrlOpen: afterImageUrlOpen,
              analysis: analysisText,
              suggestions: suggestionText,
              wallAnalysis: data.room_analysis || wallAnalysis,
            });
          } catch (error) {
            console.error(`Error generating ${category}:`, error);
            state.results.push({
              category,
              beforeUrl: imageData.preview,
              afterUrl: '',
              analysis: 'ÏÉùÏÑ± Ïã§Ìå®',
              suggestions: error.message,
              wallAnalysis: wallAnalysis,
            });
          }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // STEP 4: ÏôÑÎ£å
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        updateStep(4, 'done', '‚úÖ Î™®Îì† ÎîîÏûêÏù∏ ÏÉùÏÑ± ÏôÑÎ£å!');

        loading.classList.remove('active');
        renderResultPages();

        btn.disabled = false;
        btn.innerHTML = '‚ú® AI ÎîîÏûêÏù∏ ÏÉùÏÑ±ÌïòÍ∏∞';
        updateButtons();

        document.getElementById('downloadBtn').disabled = false;
        document.getElementById('shareBtn').disabled = false;

        showToast(`${state.results.length}Í∞ú ÎîîÏûêÏù∏ ÏÉùÏÑ± ÏôÑÎ£å!`, 'success');
        addChatMessage(`üéâ ${state.results.length}Í∞úÏùò Í≥µÍ∞Ñ ÎîîÏûêÏù∏Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!`, false);

        setTimeout(() => {
          progressSteps.classList.remove('active');
          document.querySelector('.result-section').scrollIntoView({ behavior: 'smooth' });
        }, 1500);
      }

      function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // RENDER RESULT PAGES (Í∞ÑÏÜåÌôî - ÌÜ†Í∏Ä Ïù¥ÎØ∏ÏßÄÎßå)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function renderResultPages() {
        const pagesContainer = document.getElementById('resultPages');
        const pageNav = document.getElementById('pageNav');
        const pageIndicator = document.getElementById('pageIndicator');

        pagesContainer.innerHTML = '';

        if (state.results.length === 0) return;

        state.results.forEach((result, index) => {
          const page = document.createElement('div');
          page.className = `result-page ${index === 0 ? 'active' : ''}`;
          page.dataset.index = index;

          const info = categoryInfo[result.category];

          page.innerHTML = `
          <div class="page-category">
            <span class="icon">${info.icon}</span>
            ${info.name}
          </div>
          
          <!-- Ïù∏Ïä§ÌÉÄÍ∑∏Îû® Ïä§ÌÉÄÏùº Ïù¥ÎØ∏ÏßÄ Î∑∞Ïñ¥ -->
          <div class="render-image-container">
            <div class="render-header">
              <span class="render-status" id="status_${index}">üì∑ ÏõêÎ≥∏</span>
              <span class="render-hint">‚óÄ ‚ñ∂ ÌôîÏÇ¥ÌëúÎ°ú Ïù¥ÎØ∏ÏßÄ Ï†ÑÌôò</span>
            </div>
            <div class="render-image-wrapper">
              <button class="nav-arrow left" onclick="prevImage(${index})">‚óÄ</button>
              <img class="render-main-image" 
                   id="renderImg_${index}"
                   src="${result.beforeUrl}" 
                   alt="Ïù¥ÎØ∏ÏßÄ"
                   data-original="${result.beforeUrl}"
                   data-closed="${result.afterUrl || ''}"
                   data-open="${result.afterUrlOpen || ''}"
                   data-state="original"
                   data-index="0">
              <button class="nav-arrow right" onclick="nextImage(${index})">‚ñ∂</button>
            </div>
            <div class="image-indicators">
              <div class="indicator-dot active" onclick="goToImage(${index}, 0)"></div>
              <div class="indicator-dot" onclick="goToImage(${index}, 1)"></div>
              <div class="indicator-dot" onclick="goToImage(${index}, 2)"></div>
            </div>
          </div>
        `;

          pagesContainer.appendChild(page);
        });

        // Page navigation
        if (state.results.length > 1) {
          pageNav.classList.remove('hidden');
          pageIndicator.innerHTML = state.results
            .map((_, i) => `<div class="page-dot ${i === 0 ? 'active' : ''}" onclick="goToPage(${i})"></div>`)
            .join('');
          document.getElementById('totalPages').textContent = state.results.length;
          updatePageNav();
        } else {
          pageNav.classList.add('hidden');
        }

        state.currentPage = 0;
      }

      function formatDimension(value) {
        if (!value || value === '-') return '-';
        if (typeof value === 'number') {
          return value.toLocaleString();
        }
        return value;
      }

      function getObstacleIcon(type) {
        const icons = {
          Î¨∏: 'üö™',
          Ï∞ΩÎ¨∏: 'ü™ü',
          ÏΩòÏÑºÌä∏: 'üîå',
          Î∞∞Í¥Ä: 'üîß',
          ÏóêÏñ¥Ïª®: '‚ùÑÔ∏è',
          Ïä§ÏúÑÏπò: 'üí°',
          ÌôòÍ∏∞Íµ¨: 'üåÄ',
          Í∏∞Îë•: 'üèõÔ∏è',
        };
        return icons[type] || '‚ö†Ô∏è';
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Page Navigation
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function changePage(delta) {
        const newPage = state.currentPage + delta;
        if (newPage >= 0 && newPage < state.results.length) {
          goToPage(newPage);
        }
      }

      function goToPage(index) {
        state.currentPage = index;
        document.querySelectorAll('.result-page').forEach((page, i) => {
          page.classList.toggle('active', i === index);
        });
        document.querySelectorAll('.page-dot').forEach((dot, i) => {
          dot.classList.toggle('active', i === index);
        });
        updatePageNav();
      }

      function updatePageNav() {
        document.getElementById('currentPage').textContent = state.currentPage + 1;
        document.getElementById('prevPage').disabled = state.currentPage === 0;
        document.getElementById('nextPage').disabled = state.currentPage === state.results.length - 1;
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Download & Share
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function downloadCurrentImage() {
        const result = state.results[state.currentPage];
        if (!result?.afterUrl) {
          showToast('Îã§Ïö¥Î°úÎìúÌï† Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.', 'error');
          return;
        }
        const link = document.createElement('a');
        link.href = result.afterUrl;
        link.target = '_blank';
        link.download = `dadam-${result.category}-design.png`;
        link.click();
        showToast('Ïù¥ÎØ∏ÏßÄ Îã§Ïö¥Î°úÎìú ÏãúÏûë', 'success');
      }

      async function shareResult() {
        const result = state.results[state.currentPage];
        if (!result?.afterUrl) return;
        try {
          if (navigator.share) {
            await navigator.share({
              title: `Îã§Îã¥Í∞ÄÍµ¨ AI Î¶¨ÎîîÏûêÏù∏ - ${categoryInfo[result.category].name}`,
              text: `${categoryInfo[result.category].name}Î•º "${state.selectedStyle}" Ïä§ÌÉÄÏùºÎ°ú Î¶¨ÎîîÏûêÏù∏ÌñàÏñ¥Ïöî!`,
              url: result.afterUrl,
            });
          } else {
            await navigator.clipboard.writeText(result.afterUrl);
            showToast('URLÏù¥ Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§.', 'success');
          }
        } catch (e) {
          showToast('Í≥µÏú†ÌïòÍ∏∞ Ïã§Ìå®', 'error');
        }
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Chat
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function addChatMessage(content, isUser = false, shouldSave = true) {
        const chatMessages = document.getElementById('chatMessages');
        const welcome = chatMessages.querySelector('.welcome-msg');
        if (welcome) welcome.remove();

        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
        messageDiv.innerHTML = `
        <div class="message-avatar">
          <svg fill="${isUser ? 'none' : 'currentColor'}" stroke="${isUser ? 'currentColor' : 'none'}" stroke-width="2">
            <use href="#icon-${isUser ? 'user' : 'ai'}"/>
          </svg>
        </div>
        <div class="message-content">${content}</div>
      `;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        // ÏµúÍ∑º 20Í∞ú Î©îÏãúÏßÄÎßå ÌôîÎ©¥Ïóê Ïú†ÏßÄ
        const messages = chatMessages.querySelectorAll('.message');
        if (messages.length > 20) messages[0].remove();

        // DBÏóê Ï†ÄÏû• (shouldSaveÍ∞Ä trueÏùº ÎïåÎßå)
        if (shouldSave) {
          saveChatMessage(content, isUser ? 'user' : 'assistant');
        }
      }

      async function sendMessage() {
        const input = document.getElementById('messageInput');
        const message = input.value.trim();
        if (!message) return;

        addChatMessage(message, true);
        input.value = '';

        try {
          const response = await fetch(N8N_CHAT_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message }),
          });
          const data = await response.json();
          const aiResponse = data.response || data.output || 'ÏùëÎãµÏùÑ Ï≤òÎ¶¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.';
          addChatMessage(aiResponse, false);
        } catch (error) {
          addChatMessage('ÏùºÏãúÏ†ÅÏù∏ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', false);
        }
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Toast
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function showToast(message, type = 'info') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = `toast ${type} show`;
        setTimeout(() => toast.classList.remove('show'), 3000);
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // üñºÔ∏è Ïù¥ÎØ∏ÏßÄ ÌôîÏÇ¥Ìëú ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò (ÏõêÎ≥∏ ‚Üî Îã´Ìûò ‚Üî Ïó¥Î¶º)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function goToImage(pageIndex, imageIndex) {
        const img = document.getElementById(`renderImg_${pageIndex}`);
        const status = document.getElementById(`status_${pageIndex}`);
        if (!img) return;

        const images = [
          { url: img.dataset.original, state: 'original', label: 'üì∑ ÏõêÎ≥∏', color: '#f59e0b' },
          { url: img.dataset.closed, state: 'closed', label: 'üö™ ÎèÑÏñ¥ Îã´Ìûò', color: '#3b82f6' },
          { url: img.dataset.open, state: 'open', label: 'üö™ ÎèÑÏñ¥ Ïó¥Î¶º', color: '#10b981' },
        ];

        // Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏúºÎ©¥ Ïä§ÌÇµ
        if (!images[imageIndex].url) {
          showToast('Ìï¥Îãπ Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§', 'warning');
          return;
        }

        // Ïù¥ÎØ∏ÏßÄ Î≥ÄÍ≤Ω
        img.style.opacity = '0.5';
        setTimeout(() => {
          img.src = images[imageIndex].url;
          img.dataset.state = images[imageIndex].state;
          img.dataset.index = imageIndex;
          status.textContent = images[imageIndex].label;
          status.style.color = images[imageIndex].color;
          img.style.opacity = '1';

          // Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
          updateIndicators(pageIndex, imageIndex);
        }, 100);
      }

      function nextImage(pageIndex) {
        const img = document.getElementById(`renderImg_${pageIndex}`);
        if (!img) return;
        let currentIndex = parseInt(img.dataset.index) || 0;
        let nextIndex = currentIndex + 1;

        // Îã§Ïùå Ïú†Ìö®Ìïú Ïù¥ÎØ∏ÏßÄ Ï∞æÍ∏∞
        const images = [img.dataset.original, img.dataset.closed, img.dataset.open];
        while (nextIndex < 3 && !images[nextIndex]) {
          nextIndex++;
        }
        if (nextIndex >= 3) nextIndex = 0; // Ï≤òÏùåÏúºÎ°ú

        goToImage(pageIndex, nextIndex);
      }

      function prevImage(pageIndex) {
        const img = document.getElementById(`renderImg_${pageIndex}`);
        if (!img) return;
        let currentIndex = parseInt(img.dataset.index) || 0;
        let prevIndex = currentIndex - 1;

        // Ïù¥Ï†Ñ Ïú†Ìö®Ìïú Ïù¥ÎØ∏ÏßÄ Ï∞æÍ∏∞
        const images = [img.dataset.original, img.dataset.closed, img.dataset.open];
        while (prevIndex >= 0 && !images[prevIndex]) {
          prevIndex--;
        }
        if (prevIndex < 0) {
          // ÎßàÏßÄÎßâ Ïú†Ìö®Ìïú Ïù¥ÎØ∏ÏßÄÎ°ú
          prevIndex = 2;
          while (prevIndex >= 0 && !images[prevIndex]) {
            prevIndex--;
          }
        }

        goToImage(pageIndex, prevIndex);
      }

      function updateIndicators(pageIndex, activeIndex) {
        const container = document.querySelector(`.result-page[data-index="${pageIndex}"] .image-indicators`);
        if (!container) return;
        const dots = container.querySelectorAll('.indicator-dot');
        dots.forEach((dot, i) => {
          dot.classList.toggle('active', i === activeIndex);
        });
      }

      // Ïù¥Ï†Ñ toggleImage Ìï®Ïàò Ïú†ÏßÄ (ÌÅ¥Î¶≠ ÏãúÏóêÎèÑ ÎèôÏûë)
      function toggleImage(index) {
        nextImage(index);
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Keyboard & Touch
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      document.addEventListener('keydown', (e) => {
        if (state.results.length > 1) {
          if (e.key === 'ArrowLeft') changePage(-1);
          if (e.key === 'ArrowRight') changePage(1);
        }
      });

      let touchStartX = 0;
      document.getElementById('resultPages').addEventListener(
        'touchstart',
        (e) => {
          touchStartX = e.changedTouches[0].screenX;
        },
        { passive: true }
      );

      document.getElementById('resultPages').addEventListener(
        'touchend',
        (e) => {
          const diff = touchStartX - e.changedTouches[0].screenX;
          if (Math.abs(diff) > 50) changePage(diff > 0 ? 1 : -1);
        },
        { passive: true }
      );

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Init
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      document.addEventListener('DOMContentLoaded', updateButtons);
    </script>
  </body>
</html>
