<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#B8956C">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>AI ì„¤ê³„ - ë‹¤ë‹´ê°€êµ¬</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Noto+Serif+KR:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--white:#FAFAFA;--cream:#F8F7F4;--warm:#EBE8E2;--gray:#8B8680;--charcoal:#2D2A26;--black:#1A1918;--gold:#B8956C;--gold-light:#D4B896}
    body{font-family:'Pretendard',-apple-system,BlinkMacSystemFont,system-ui,sans-serif;background:var(--white);color:var(--charcoal);line-height:1.7;-webkit-tap-highlight-color:transparent}
    h1,h2,h3,h4{font-family:'Playfair Display','Noto Serif KR',serif;font-weight:500}
    a{text-decoration:none;color:inherit}
    button{-webkit-tap-highlight-color:transparent}

    /* Navigation */
    .nav{position:fixed;top:0;left:0;right:0;z-index:100;padding:0 48px;height:72px;display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.97);backdrop-filter:blur(10px);box-shadow:0 1px 3px rgba(0,0,0,.08)}
    .nav-logo{display:flex;align-items:center;gap:8px;color:var(--charcoal)}
    .nav-logo svg{width:28px;height:28px}
    .nav-logo span{font-family:'Playfair Display',serif;font-size:22px}
    .nav-menu{display:flex;gap:28px}
    .nav-menu a{color:var(--charcoal);font-size:13px;letter-spacing:.5px;transition:all .3s}
    .nav-menu a:hover{opacity:.7}
    .nav-menu a.active{color:var(--gold);font-weight:500}
    .nav-icons{display:flex;align-items:center;gap:20px;color:var(--charcoal)}
    .nav-icons button{background:none;border:none;color:inherit;cursor:pointer;padding:4px}

    .hamburger{display:none;flex-direction:column;gap:5px;padding:8px;cursor:pointer;background:none;border:none}
    .hamburger span{width:24px;height:2px;background:var(--charcoal);border-radius:2px;transition:all .3s}
    .hamburger.active span:nth-child(1){transform:rotate(45deg) translate(5px,5px)}
    .hamburger.active span:nth-child(2){opacity:0}
    .hamburger.active span:nth-child(3){transform:rotate(-45deg) translate(5px,-5px)}

    .mobile-menu{position:fixed;top:64px;left:0;right:0;bottom:0;background:var(--white);z-index:99;padding:24px;display:none;flex-direction:column;gap:8px}
    .mobile-menu.active{display:flex}
    .mobile-menu a{padding:16px 20px;font-size:16px;border-radius:12px;transition:background .3s}
    .mobile-menu a:hover,.mobile-menu a.active{background:var(--cream);color:var(--gold)}

    /* Hero */
    .hero{padding:100px 48px 32px;background:linear-gradient(180deg,var(--cream) 0%,var(--white) 100%);text-align:center}
    .hero-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 16px;background:rgba(184,149,108,.12);border-radius:20px;color:var(--gold);font-size:11px;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:16px}
    .hero h1{font-size:36px;margin-bottom:10px}
    .hero h1 span{color:var(--gold)}
    .hero p{color:var(--gray);font-size:15px}

    .main-container{max-width:1100px;margin:0 auto;padding:0 24px 60px}

    /* Chat Box */
    .chat-box{background:var(--white);border:1px solid var(--warm);border-radius:16px;overflow:hidden;margin-bottom:32px;box-shadow:0 4px 20px rgba(0,0,0,.04)}
    .chat-header{padding:14px 20px;background:var(--cream);display:flex;align-items:center;gap:12px;border-bottom:1px solid var(--warm)}
    .chat-header-icon{width:36px;height:36px;background:linear-gradient(135deg,var(--gold),#D4A574);border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
    .chat-header-icon svg{width:18px;height:18px;color:#fff}
    .chat-header-text h3{font-size:15px;font-family:inherit;font-weight:600}
    .chat-header-text p{font-size:11px;color:var(--gray)}
    .chat-status{margin-left:auto;display:flex;align-items:center;gap:5px;font-size:11px;color:var(--gray)}
    .chat-status::before{content:'';width:7px;height:7px;background:#4CAF50;border-radius:50%}
    .chat-messages{height:100px;padding:16px 20px;overflow-y:auto;display:flex;flex-direction:column;gap:10px;background:var(--white)}
    .message{display:flex;gap:10px;max-width:85%}
    .message.user{flex-direction:row-reverse;margin-left:auto}
    .message-avatar{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
    .message.ai .message-avatar{background:linear-gradient(135deg,var(--gold),#D4A574)}
    .message.ai .message-avatar svg{width:14px;height:14px;color:#fff}
    .message.user .message-avatar{background:var(--charcoal)}
    .message.user .message-avatar svg{width:14px;height:14px;color:#fff}
    .message-content{padding:10px 14px;border-radius:12px;font-size:13px;line-height:1.6}
    .message.ai .message-content{background:var(--cream);border-bottom-left-radius:4px}
    .message.user .message-content{background:var(--charcoal);color:#fff;border-bottom-right-radius:4px}
    .welcome-msg{text-align:center;padding:16px;color:var(--gray);font-size:13px}
    .welcome-msg strong{color:var(--charcoal);display:block;margin-bottom:4px}
    .chat-input{padding:14px 20px;border-top:1px solid var(--warm);background:var(--cream);display:flex;gap:10px}
    .chat-input input{flex:1;padding:12px 14px;border:1px solid var(--warm);border-radius:10px;font-size:16px;background:var(--white)}
    .chat-input input:focus{outline:none;border-color:var(--gold)}
    .chat-input button{width:44px;height:44px;background:var(--charcoal);border:none;border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .3s;flex-shrink:0}
    .chat-input button:hover{background:var(--gold)}
    .chat-input button svg{width:18px;height:18px;color:#fff}

    /* Section Title */
    .section-title{font-size:14px;color:var(--gray);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:16px;text-align:center}
    .section-subtitle{text-align:center;color:var(--gold);font-size:12px;margin-top:-12px;margin-bottom:16px}

    /* Category Grid */
    .category-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px}
    .category-card{background:var(--white);border:2px solid var(--warm);border-radius:16px;padding:20px 12px;text-align:center;cursor:pointer;transition:all .3s;position:relative;overflow:hidden}
    .category-card:hover{border-color:var(--gold);transform:translateY(-2px)}
    .category-card:active{transform:scale(0.98)}
    .category-card.has-image{border-color:var(--gold)}
    .category-card .check-badge{position:absolute;top:8px;right:8px;width:22px;height:22px;background:var(--gold);color:#fff;border-radius:50%;font-size:12px;display:none;align-items:center;justify-content:center}
    .category-card.has-image .check-badge{display:flex}
    .category-card .remove-btn{position:absolute;top:8px;left:8px;width:24px;height:24px;background:rgba(239,68,68,.9);color:#fff;border:none;border-radius:50%;font-size:14px;cursor:pointer;display:none;align-items:center;justify-content:center;z-index:10;transition:all .2s;box-shadow:0 2px 6px rgba(0,0,0,.2)}
    .category-card.has-image .remove-btn{display:flex}
    .category-card .remove-btn:hover{background:#dc2626;transform:scale(1.1)}
    .category-icon{font-size:32px;margin-bottom:8px;display:block}
    .category-name{font-size:14px;font-weight:600;color:var(--charcoal);margin-bottom:2px}
    .category-desc{font-size:10px;color:var(--gray)}
    .category-preview{width:100%;height:70px;object-fit:cover;border-radius:8px;margin-bottom:6px;display:none}
    .category-card.has-image .category-preview{display:block}
    .category-card.has-image .category-icon{display:none}
    .file-input{display:none}

    /* Selected Count Badge */
    .selected-count{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;background:var(--gold);color:#fff;border-radius:20px;font-size:13px;margin-bottom:20px}
    .selected-count.hidden{display:none}

    /* Style Selector */
    .style-selector{display:flex;justify-content:center;gap:10px;margin-bottom:24px;flex-wrap:wrap;padding:0 10px}
    .style-chip{padding:10px 16px;background:var(--white);border:1px solid var(--warm);border-radius:20px;font-size:13px;cursor:pointer;transition:all .3s;white-space:nowrap}
    .style-chip:hover{border-color:var(--gold)}
    .style-chip:active{transform:scale(0.95)}
    .style-chip.active{background:var(--gold);color:#fff;border-color:var(--gold)}

    /* Single Generate Button */
    .generate-section{text-align:center;margin-bottom:32px}
    .generate-btn{width:100%;max-width:400px;padding:18px 32px;border:none;border-radius:14px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s;display:inline-flex;align-items:center;justify-content:center;gap:10px;background:linear-gradient(135deg,var(--gold),var(--gold-light));color:#fff;box-shadow:0 4px 20px rgba(184,149,108,.3)}
    .generate-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 28px rgba(184,149,108,.4)}
    .generate-btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
    .generate-btn .spinner{width:20px;height:20px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Progress Steps */
    .progress-steps{display:none;margin-bottom:24px;padding:20px;background:var(--cream);border-radius:16px}
    .progress-steps.active{display:block}
    .step-list{display:flex;justify-content:space-between;position:relative;margin-bottom:16px}
    .step-list::before{content:'';position:absolute;top:15px;left:10%;right:10%;height:2px;background:var(--warm)}
    .step{display:flex;flex-direction:column;align-items:center;gap:8px;position:relative;z-index:1}
    .step-icon{width:32px;height:32px;border-radius:50%;background:var(--warm);display:flex;align-items:center;justify-content:center;font-size:14px;transition:all .3s}
    .step.active .step-icon{background:var(--gold);color:#fff}
    .step.done .step-icon{background:#10b981;color:#fff}
    .step-label{font-size:11px;color:var(--gray);text-align:center}
    .step.active .step-label{color:var(--charcoal);font-weight:600}
    .progress-text{text-align:center;font-size:13px;color:var(--charcoal)}

    /* Result Section */
    .result-section{background:var(--cream);border-radius:20px;padding:24px;min-height:300px}
    
    .result-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:12px}
    .result-header h2{font-size:18px;display:flex;align-items:center;gap:10px}
    .result-header h2 span{font-size:11px;padding:4px 10px;background:var(--gold);color:#fff;border-radius:10px;font-family:sans-serif}
    .result-actions{display:flex;gap:8px}
    .result-btn{padding:10px 14px;border-radius:10px;font-size:12px;font-weight:500;cursor:pointer;transition:all .3s;display:flex;align-items:center;gap:6px}
    .result-btn.download{background:var(--charcoal);color:#fff;border:none}
    .result-btn.download:hover{background:var(--gold)}
    .result-btn.share{background:transparent;color:var(--charcoal);border:1px solid var(--charcoal)}
    .result-btn.share:hover{background:var(--charcoal);color:#fff}
    .result-btn:disabled{opacity:.5;cursor:not-allowed}

    /* Page Navigation */
    .page-nav{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:20px}
    .page-nav.hidden{display:none}
    .page-arrow{width:40px;height:40px;border-radius:50%;border:1px solid var(--warm);background:var(--white);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s}
    .page-arrow:hover:not(:disabled){background:var(--gold);border-color:var(--gold);color:#fff}
    .page-arrow:disabled{opacity:.4;cursor:not-allowed}
    .page-arrow svg{width:20px;height:20px}
    .page-indicator{display:flex;gap:8px;align-items:center}
    .page-dot{width:10px;height:10px;border-radius:50%;background:var(--warm);cursor:pointer;transition:all .3s}
    .page-dot.active{background:var(--gold);width:24px;border-radius:5px}
    .page-dot:hover{background:var(--gold)}
    .page-info{font-size:14px;color:var(--gray);min-width:60px;text-align:center}
    .page-info span{color:var(--charcoal);font-weight:600}

    /* Result Pages */
    .result-pages{position:relative;overflow:hidden}
    .result-page{display:none}
    .result-page.active{display:block;animation:fadeIn .3s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}

    .page-category{display:inline-flex;align-items:center;gap:8px;padding:8px 16px;background:var(--white);border-radius:12px;margin-bottom:16px;font-size:14px;font-weight:600;color:var(--charcoal);box-shadow:0 2px 8px rgba(0,0,0,.06)}
    .page-category .icon{font-size:20px}

    .result-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px}
    .result-card{background:var(--white);border-radius:14px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,.05)}
    .result-card-header{padding:10px 14px;background:var(--white);border-bottom:1px solid var(--warm);display:flex;align-items:center;gap:6px}
    .result-card-header .dot{width:8px;height:8px;border-radius:50%}
    .result-card-header .dot.before{background:#ef4444}
    .result-card-header .dot.after{background:#10b981}
    .result-card-header span{font-size:11px;font-weight:600;color:var(--gray);text-transform:uppercase;letter-spacing:1px}
    .result-card img{width:100%;height:220px;object-fit:cover;display:block}
    
    /* Wall Analysis in Result - ìƒì„¸ ë²„ì „ */
    .wall-analysis-box{background:var(--white);border-radius:14px;padding:16px;margin-bottom:16px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
    .wall-analysis-box h4{font-size:13px;color:var(--gold);margin-bottom:12px;display:flex;align-items:center;gap:8px}
    .wall-analysis-box h4 .badge{font-size:10px;padding:2px 8px;background:var(--charcoal);color:#fff;border-radius:8px;font-family:sans-serif}
    
    .dimension-display{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px;padding:16px;background:linear-gradient(135deg,rgba(184,149,108,.08),rgba(212,184,150,.08));border-radius:12px}
    .dimension-item{text-align:center}
    .dimension-item .value{font-size:20px;font-weight:700;color:var(--charcoal)}
    .dimension-item .unit{font-size:11px;color:var(--gold);font-weight:600}
    .dimension-item .label{font-size:10px;color:var(--gray);margin-top:2px}
    
    .wall-info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-bottom:12px}
    .wall-info-item{background:var(--cream);padding:10px 12px;border-radius:10px}
    .wall-info-item .label{font-size:10px;color:var(--gray);margin-bottom:4px}
    .wall-info-item .value{font-size:13px;font-weight:600;color:var(--charcoal)}
    
    .install-zone{background:linear-gradient(90deg,var(--gold),var(--gold-light));color:#fff;padding:12px 16px;border-radius:10px;margin-bottom:12px}
    .install-zone .title{font-size:11px;opacity:.8;margin-bottom:4px}
    .install-zone .dims{font-size:15px;font-weight:700}
    
    .obstacles-list{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px}
    .obstacle-tag{padding:6px 10px;background:var(--cream);border-radius:8px;font-size:11px;color:var(--charcoal);display:flex;align-items:center;gap:4px}
    .obstacle-tag.warning{background:#fef3c7;color:#92400e}
    
    .wall-features{display:flex;flex-wrap:wrap;gap:6px}
    .wall-feature{padding:4px 10px;background:var(--cream);border-radius:8px;font-size:10px;color:var(--gray)}
    .wall-feature.detected{background:var(--gold);color:#fff}
    
    .bg-refresh-box{background:linear-gradient(135deg,#f0fdf4,#dcfce7);border:1px solid #86efac;border-radius:10px;padding:12px;margin-top:12px}
    .bg-refresh-box h5{font-size:11px;color:#166534;margin-bottom:8px;display:flex;align-items:center;gap:6px}
    .bg-refresh-item{font-size:11px;color:#15803d;padding:4px 0}

    .result-analysis{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .analysis-card{background:var(--white);border-radius:12px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,.04)}
    .analysis-card h4{font-size:12px;color:var(--gold);margin-bottom:6px;display:flex;align-items:center;gap:6px;font-family:inherit}
    .analysis-card p{font-size:12px;color:var(--charcoal);line-height:1.6}

    /* Placeholder & Loading */
    .result-placeholder{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:60px 20px;color:var(--gray)}
    .result-placeholder .icon{font-size:56px;margin-bottom:16px;opacity:.4}
    .result-placeholder h3{font-size:17px;color:var(--charcoal);margin-bottom:8px;font-family:inherit}
    .result-placeholder p{font-size:13px;max-width:300px}
    .result-placeholder.hidden{display:none}

    .result-loading{display:none;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}
    .result-loading.active{display:flex}
    .result-loading .spinner{width:48px;height:48px;border:3px solid var(--warm);border-top-color:var(--gold);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:20px}
    .result-loading h3{font-size:17px;color:var(--charcoal);margin-bottom:8px}
    .result-loading p{font-size:13px;color:var(--gray)}

    /* Footer */
    .footer{padding:48px;background:var(--charcoal);color:#fff;margin-top:60px}
    .footer-content{max-width:1100px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
    .footer-brand{display:flex;align-items:center;gap:8px}
    .footer-brand svg{width:24px;height:24px}
    .footer-brand span{font-family:'Playfair Display',serif;font-size:18px}
    .footer-links{display:flex;gap:24px}
    .footer-links a{color:rgba(255,255,255,.6);font-size:13px;transition:color .3s}
    .footer-links a:hover{color:#fff}
    .footer-copy{text-align:center;margin-top:24px;padding-top:20px;border-top:1px solid rgba(255,255,255,.1);font-size:11px;color:rgba(255,255,255,.4)}

    /* Toast */
    .toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--charcoal);color:#fff;padding:14px 24px;border-radius:12px;font-size:14px;z-index:1000;transition:transform .3s;max-width:90%}
    .toast.show{transform:translateX(-50%) translateY(0)}
    .toast.success{background:#10b981}
    .toast.error{background:#ef4444}

    /* Responsive */
    @media(max-width:1024px){
      .nav{padding:0 32px}
      .hero{padding:100px 32px 28px}
      .main-container{padding:0 20px 50px}
    }

    @media(max-width:768px){
      .nav{padding:0 16px;height:64px}
      .nav-logo span{font-size:20px}
      .nav-menu{display:none}
      .hamburger{display:flex}
      
      .hero{padding:84px 16px 20px}
      .hero h1{font-size:28px}
      .hero p{font-size:14px}
      
      .main-container{padding:0 12px 40px}
      
      .chat-box{margin-bottom:20px}
      .chat-messages{height:80px}
      
      .category-grid{grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:20px}
      .category-card{padding:14px 10px}
      .category-icon{font-size:26px}
      .category-name{font-size:13px}
      .category-desc{font-size:9px}
      .category-preview{height:60px}
      
      .style-selector{gap:8px;overflow-x:auto;flex-wrap:nowrap;justify-content:flex-start;padding:0 12px 8px;-webkit-overflow-scrolling:touch}
      .style-chip{padding:8px 14px;font-size:12px;flex-shrink:0}
      
      .generate-btn{padding:16px 24px;font-size:15px}
      
      .step-label{font-size:10px}
      
      .result-section{padding:16px}
      .result-grid{grid-template-columns:1fr}
      .result-card img{height:180px}
      .result-analysis{grid-template-columns:1fr}
      .wall-info-grid{grid-template-columns:1fr 1fr}
      
      .page-nav{gap:8px}
      .page-arrow{width:36px;height:36px}
      
      .footer{padding:32px 16px}
      .footer-content{flex-direction:column;gap:20px;text-align:center}
      .footer-links{flex-wrap:wrap;justify-content:center}
    }

    @media(max-width:480px){
      .nav{height:56px}
      .hero{padding:72px 12px 16px}
      .hero h1{font-size:24px}
      .category-grid{gap:8px}
      .category-icon{font-size:22px}
      .category-name{font-size:12px}
      .category-desc{display:none}
      .category-preview{height:50px}
      .result-card img{height:150px}
      .wall-info-grid{grid-template-columns:1fr}
    }

    @media(hover:none){
      .category-card:hover{transform:none}
      .generate-btn:hover:not(:disabled){transform:none}
    }

    @supports(padding:max(0px)){
      .nav{padding-left:max(16px,env(safe-area-inset-left));padding-right:max(16px,env(safe-area-inset-right))}
      .main-container{padding-left:max(12px,env(safe-area-inset-left));padding-right:max(12px,env(safe-area-inset-right))}
      .toast{bottom:max(24px,env(safe-area-inset-bottom))}
    }
  </style>
</head>
<body>
  <!-- SVG Symbols -->
  <svg style="display:none">
    <symbol id="icon-logo" viewBox="0 0 40 40"><path d="M20 4L4 12v16l16 8 16-8V12L20 4zm0 4l12 6-12 6-12-6 12-6zm-12 10l12 6 12-6v8l-12 6-12-6v-8z"/></symbol>
    <symbol id="icon-ai" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13A2.5 2.5 0 0 0 5 15.5 2.5 2.5 0 0 0 7.5 18a2.5 2.5 0 0 0 2.5-2.5A2.5 2.5 0 0 0 7.5 13m9 0a2.5 2.5 0 0 0-2.5 2.5 2.5 2.5 0 0 0 2.5 2.5 2.5 2.5 0 0 0 2.5-2.5 2.5 2.5 0 0 0-2.5-2.5z"/></symbol>
    <symbol id="icon-user" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></symbol>
    <symbol id="icon-send" viewBox="0 0 24 24"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></symbol>
    <symbol id="icon-sparkle" viewBox="0 0 24 24"><path d="M12 2l2.4 7.2L22 12l-7.6 2.8L12 22l-2.4-7.2L2 12l7.6-2.8L12 2z"/></symbol>
    <symbol id="icon-download" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></symbol>
    <symbol id="icon-share" viewBox="0 0 24 24"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><path d="m8.59 13.51 6.83 3.98M15.41 6.51l-6.82 3.98"/></symbol>
    <symbol id="icon-chevron-left" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6" fill="none" stroke="currentColor" stroke-width="2"/></symbol>
    <symbol id="icon-chevron-right" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6" fill="none" stroke="currentColor" stroke-width="2"/></symbol>
  </svg>

  <!-- Navigation -->
  <nav class="nav">
    <a href="index.html" class="nav-logo">
      <svg fill="currentColor"><use href="#icon-logo"/></svg>
      <span>ë‹¤ë‹´</span>
    </a>
    <div class="nav-menu">
      <a href="index.html">About us</a>
      <a href="index.html">Collection</a>
      <a href="index.html">Products</a>
      <a href="ai-design.html" class="active">AI Design</a>
      <a href="index.html">Stories</a>
      <a href="index.html">Showroom</a>
      <a href="index.html">Service</a>
    </div>
    <div class="nav-icons">
      <button class="hamburger" onclick="toggleMobileMenu()" aria-label="ë©”ë‰´">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobileMenu">
    <a href="index.html">About us</a>
    <a href="index.html">Collection</a>
    <a href="index.html">Products</a>
    <a href="ai-design.html" class="active">AI Design</a>
    <a href="index.html">Stories</a>
    <a href="index.html">Showroom</a>
    <a href="index.html">Service</a>
  </div>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-badge">
      <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><use href="#icon-sparkle"/></svg>
      AI-Powered Design
    </div>
    <h1>AI <span>ì„¤ê³„</span> ì‹œìŠ¤í…œ</h1>
    <p>ì‚¬ì§„ í•œ ì¥ìœ¼ë¡œ ë§ì¶¤ ê°€êµ¬ë¥¼ ë””ìì¸í•˜ì„¸ìš”</p>
  </section>

  <!-- Main Container -->
  <main class="main-container">
    
    <!-- AI Chat Box -->
    <div class="chat-box">
      <div class="chat-header">
        <div class="chat-header-icon">
          <svg><use href="#icon-ai"/></svg>
        </div>
        <div class="chat-header-text">
          <h3>ë‹¤ë‹´ AI ì„¤ê³„ì‚¬</h3>
          <p>ë§ì¶¤ ê°€êµ¬ ì„¤ê³„ ì „ë¬¸ AI</p>
        </div>
        <div class="chat-status">ì˜¨ë¼ì¸</div>
      </div>
      <div class="chat-messages" id="chatMessages">
        <div class="welcome-msg">
          <strong>ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”!</strong>
          ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ê³  ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.
        </div>
      </div>
      <div class="chat-input">
        <input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeydown="if(event.key==='Enter')sendMessage()">
        <button onclick="sendMessage()" aria-label="ì „ì†¡">
          <svg fill="none" stroke="currentColor" stroke-width="2"><use href="#icon-send"/></svg>
        </button>
      </div>
    </div>

    <!-- Category Grid -->
    <p class="section-title">ì¹´í…Œê³ ë¦¬ ì„ íƒ</p>
    <p class="section-subtitle">ğŸ’¡ ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥ - í´ë¦­í•˜ì—¬ ì‚¬ì§„ ì—…ë¡œë“œ</p>
    
    <div style="text-align:center">
      <div class="selected-count hidden" id="selectedCount">ğŸ“· <span>0</span>ê°œ ì´ë¯¸ì§€ ì—…ë¡œë“œë¨</div>
    </div>
    
    <div class="category-grid">
      <div class="category-card" data-category="sink" onclick="selectCategory('sink')">
        <button class="remove-btn" onclick="removeImage('sink', event)" title="ì‚­ì œ">âœ•</button>
        <div class="check-badge">âœ“</div>
        <img class="category-preview" id="preview-sink" src="" alt="">
        <span class="category-icon">ğŸ³</span>
        <div class="category-name">ì‹±í¬ëŒ€</div>
        <div class="category-desc">ì£¼ë°© ì‹±í¬ëŒ€ & ìƒí•˜ë¶€ì¥</div>
      </div>
      <div class="category-card" data-category="wardrobe" onclick="selectCategory('wardrobe')">
        <button class="remove-btn" onclick="removeImage('wardrobe', event)" title="ì‚­ì œ">âœ•</button>
        <div class="check-badge">âœ“</div>
        <img class="category-preview" id="preview-wardrobe" src="" alt="">
        <span class="category-icon">ğŸ‘”</span>
        <div class="category-name">ë¶™ë°•ì´ì¥</div>
        <div class="category-desc">ì˜·ì¥ & ìˆ˜ë‚© ì‹œìŠ¤í…œ</div>
      </div>
      <div class="category-card" data-category="fridge" onclick="selectCategory('fridge')">
        <button class="remove-btn" onclick="removeImage('fridge', event)" title="ì‚­ì œ">âœ•</button>
        <div class="check-badge">âœ“</div>
        <img class="category-preview" id="preview-fridge" src="" alt="">
        <span class="category-icon">ğŸ§Š</span>
        <div class="category-name">ëƒ‰ì¥ê³ ì¥</div>
        <div class="category-desc">ëƒ‰ì¥ê³ ì¥ & í‚¤í°ì¥</div>
      </div>
      <div class="category-card" data-category="vanity" onclick="selectCategory('vanity')">
        <button class="remove-btn" onclick="removeImage('vanity', event)" title="ì‚­ì œ">âœ•</button>
        <div class="check-badge">âœ“</div>
        <img class="category-preview" id="preview-vanity" src="" alt="">
        <span class="category-icon">ğŸ’„</span>
        <div class="category-name">í™”ì¥ëŒ€</div>
        <div class="category-desc">ë“œë ˆì„œ & í™”ì¥ëŒ€</div>
      </div>
      <div class="category-card" data-category="shoe" onclick="selectCategory('shoe')">
        <button class="remove-btn" onclick="removeImage('shoe', event)" title="ì‚­ì œ">âœ•</button>
        <div class="check-badge">âœ“</div>
        <img class="category-preview" id="preview-shoe" src="" alt="">
        <span class="category-icon">ğŸ‘Ÿ</span>
        <div class="category-name">ì‹ ë°œì¥</div>
        <div class="category-desc">í˜„ê´€ ì‹ ë°œì¥ & ìˆ˜ë‚©</div>
      </div>
      <div class="category-card" data-category="storage" onclick="selectCategory('storage')">
        <button class="remove-btn" onclick="removeImage('storage', event)" title="ì‚­ì œ">âœ•</button>
        <div class="check-badge">âœ“</div>
        <img class="category-preview" id="preview-storage" src="" alt="">
        <span class="category-icon">ğŸ“¦</span>
        <div class="category-name">ììœ  ìˆ˜ë‚©ì¥</div>
        <div class="category-desc">ë‹¤ìš©ë„ ìˆ˜ë‚© ê°€êµ¬</div>
      </div>
    </div>

    <!-- Hidden File Inputs -->
    <input type="file" class="file-input" id="file-sink" accept="image/*" onchange="handleFileUpload('sink', this)">
    <input type="file" class="file-input" id="file-wardrobe" accept="image/*" onchange="handleFileUpload('wardrobe', this)">
    <input type="file" class="file-input" id="file-fridge" accept="image/*" onchange="handleFileUpload('fridge', this)">
    <input type="file" class="file-input" id="file-vanity" accept="image/*" onchange="handleFileUpload('vanity', this)">
    <input type="file" class="file-input" id="file-shoe" accept="image/*" onchange="handleFileUpload('shoe', this)">
    <input type="file" class="file-input" id="file-storage" accept="image/*" onchange="handleFileUpload('storage', this)">

    <!-- Style Selector -->
    <div class="style-selector">
      <div class="style-chip active" data-style="ëª¨ë˜" onclick="selectStyle(this)">ğŸ¢ ëª¨ë˜</div>
      <div class="style-chip" data-style="ìŠ¤ì¹¸ë””ë‚˜ë¹„ì•ˆ" onclick="selectStyle(this)">ğŸŒ² ìŠ¤ì¹¸ë””ë‚˜ë¹„ì•ˆ</div>
      <div class="style-chip" data-style="ì¸ë”ìŠ¤íŠ¸ë¦¬ì–¼" onclick="selectStyle(this)">ğŸ­ ì¸ë”ìŠ¤íŠ¸ë¦¬ì–¼</div>
      <div class="style-chip" data-style="ë¯¸ë‹ˆë©€" onclick="selectStyle(this)">â—»ï¸ ë¯¸ë‹ˆë©€</div>
      <div class="style-chip" data-style="ëŸ­ì…”ë¦¬" onclick="selectStyle(this)">âœ¨ ëŸ­ì…”ë¦¬</div>
    </div>

    <!-- Single Generate Button -->
    <div class="generate-section">
      <button class="generate-btn" id="generateBtn" onclick="startGeneration()" disabled>
        âœ¨ AI ë””ìì¸ ìƒì„±í•˜ê¸°
      </button>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps" id="progressSteps">
      <div class="step-list">
        <div class="step" id="step1">
          <div class="step-icon">1</div>
          <div class="step-label">ì´ë¯¸ì§€ ë¶„ì„</div>
        </div>
        <div class="step" id="step2">
          <div class="step-icon">2</div>
          <div class="step-label">ë²½ êµ¬ì¡° íŒŒì•…</div>
        </div>
        <div class="step" id="step3">
          <div class="step-icon">3</div>
          <div class="step-label">ë””ìì¸ ìƒì„±</div>
        </div>
        <div class="step" id="step4">
          <div class="step-icon">4</div>
          <div class="step-label">ì™„ë£Œ</div>
        </div>
      </div>
      <p class="progress-text" id="progressText">ì¤€ë¹„ ì¤‘...</p>
    </div>

    <!-- Result Section -->
    <section class="result-section">
      <div class="result-header">
        <h2>ğŸ–¼ï¸ ë¦¬ë””ìì¸ ê²°ê³¼ <span>AI Generated</span></h2>
        <div class="result-actions">
          <button class="result-btn download" id="downloadBtn" onclick="downloadCurrentImage()" disabled>
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><use href="#icon-download"/></svg>
            ë‹¤ìš´ë¡œë“œ
          </button>
          <button class="result-btn share" id="shareBtn" onclick="shareResult()" disabled>
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><use href="#icon-share"/></svg>
            ê³µìœ 
          </button>
        </div>
      </div>

      <!-- Page Navigation -->
      <div class="page-nav hidden" id="pageNav">
        <button class="page-arrow" id="prevPage" onclick="changePage(-1)">
          <svg><use href="#icon-chevron-left"/></svg>
        </button>
        <div class="page-indicator" id="pageIndicator"></div>
        <div class="page-info"><span id="currentPage">1</span> / <span id="totalPages">1</span></div>
        <button class="page-arrow" id="nextPage" onclick="changePage(1)">
          <svg><use href="#icon-chevron-right"/></svg>
        </button>
      </div>

      <!-- Placeholder -->
      <div class="result-placeholder" id="resultPlaceholder">
        <div class="icon">ğŸ¨</div>
        <h3>ë””ìì¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</h3>
        <p>ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ê³  ì‚¬ì§„ì„ ì—…ë¡œë“œí•œ í›„ ìƒì„± ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</p>
      </div>

      <!-- Loading -->
      <div class="result-loading" id="resultLoading">
        <div class="spinner"></div>
        <h3 id="loadingTitle">AIê°€ ë¶„ì„ ì¤‘...</h3>
        <p id="loadingText">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
      </div>

      <!-- Result Pages Container -->
      <div class="result-pages" id="resultPages"></div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <a href="index.html" class="footer-brand">
        <svg fill="currentColor"><use href="#icon-logo"/></svg>
        <span>ë‹¤ë‹´</span>
      </a>
      <div class="footer-links">
        <a href="index.html">í™ˆ</a>
        <a href="#">ì œí’ˆ</a>
        <a href="#">ì‹œê³µì‚¬ë¡€</a>
        <a href="#">ì‡¼ë£¸</a>
        <a href="#">ê³ ê°ì„¼í„°</a>
      </div>
    </div>
    <p class="footer-copy">Â© 2024 ë‹¤ë‹´ê°€êµ¬. All rights reserved.</p>
  </footer>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // API URLs
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const N8N_CHAT_URL = 'https://dadam.app.n8n.cloud/webhook/chat';
    const N8N_INTERIOR_URL = 'https://dadam.app.n8n.cloud/webhook/interior-design';
    //const N8N_WALL_ANALYSIS_URL = 'https://dadam.app.n8n.cloud/webhook/wall-analysis';

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ìƒì„¸ ê³µê°„ ë¶„ì„ í”„ë¡¬í”„íŠ¸ (Claude Visionìš©)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const DETAILED_ANALYSIS_PROMPT = `ë‹¹ì‹ ì€ ì „ë¬¸ 3D ê±´ì¶• ëª¨ë¸ëŸ¬ì´ì ì¸í…Œë¦¬ì–´ ì¸¡ëŸ‰ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. 
ì´ ê³µê°„ ì´ë¯¸ì§€ë¥¼ ì •ë°€ ë¶„ì„í•˜ì—¬ ë§ì¶¤ ê°€êµ¬ ì„¤ì¹˜ë¥¼ ìœ„í•œ ìƒì„¸ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì„¸ìš”.

## ë¶„ì„ ì§€ì¹¨

### 1. ê¸°ì¤€ ì‚¬ë¬¼ì„ í†µí•œ ì¹˜ìˆ˜ ì¶”ì •
- í‘œì¤€ ë¬¸ ë†’ì´: 2,100mm, í­: 900mm
- í‘œì¤€ ì°½ë¬¸ ë†’ì´: 1,200mm
- í‘œì¤€ ì½˜ì„¼íŠ¸ ë†’ì´: ë°”ë‹¥ì—ì„œ 300mm
- í‘œì¤€ ìŠ¤ìœ„ì¹˜ ë†’ì´: ë°”ë‹¥ì—ì„œ 1,200mm
- í‘œì¤€ ì²œì¥ ë†’ì´: 2,400mm (ì•„íŒŒíŠ¸ ê¸°ì¤€)
- ì—ì–´ì»¨ ì‹¤ë‚´ê¸° í­: ì•½ 800-1,000mm

### 2. ë¶„ì„ í•­ëª©
- ê° ë²½ë©´ì˜ ì˜ˆìƒ ê°€ë¡œ ê¸¸ì´ (mm ë‹¨ìœ„)
- ì²œì¥ ë†’ì´ ì¶”ì •
- ì¥ì• ë¬¼(ë¬¸, ì°½ë¬¸, ì½˜ì„¼íŠ¸, ë°°ê´€, ì—ì–´ì»¨ ë“±) ì •í™•í•œ ìœ„ì¹˜
- ê°€êµ¬ ì„¤ì¹˜ ê°€ëŠ¥ ì˜ì—­ (ì‹œì‘ì ~ëì )
- ë²½ë©´ ìƒíƒœ (ë²½ì§€ ìƒíƒœ, ìŠµê¸°, ê· ì—´ ë“±)
- ë°”ë‹¥ ì¬ì§ˆ ë° ìƒíƒœ

### 3. JSON ì‘ë‹µ í˜•ì‹
{
  "space_analysis": {
    "layout_type": "ì¼ìí˜•/ã„±ìí˜•/ã„·ìí˜•",
    "estimated_dimensions": {
      "total_width_mm": ìˆ«ì,
      "ceiling_height_mm": ìˆ«ì,
      "depth_mm": ìˆ«ì
    },
    "reference_objects": [
      {"type": "ë¬¸/ì°½ë¬¸/ì½˜ì„¼íŠ¸/ì—ì–´ì»¨", "estimated_size": "í­xë†’ì´mm", "position": "ì¢Œì¸¡/ì¤‘ì•™/ìš°ì¸¡"}
    ]
  },
  "walls": [
    {
      "position": "left/front/right",
      "estimated_width_mm": ìˆ«ì,
      "installable_zone": {
        "start_mm": ì‹œì‘ìœ„ì¹˜,
        "end_mm": ëìœ„ì¹˜,
        "available_width_mm": ì„¤ì¹˜ê°€ëŠ¥í­,
        "max_height_mm": ìµœëŒ€ë†’ì´
      },
      "obstacles": [
        {"type": "ë¬¸/ì°½ë¬¸/ì½˜ì„¼íŠ¸/ë°°ê´€", "position_mm": ìœ„ì¹˜, "size_mm": "í­xë†’ì´", "clearance_required_mm": í•„ìš”ì—¬ìœ ê³µê°„}
      ],
      "condition": {
        "wall_state": "ì–‘í˜¸/ë³´ìˆ˜í•„ìš”/ìŠµê¸°ì†ìƒ",
        "wallpaper": "ìˆìŒ/ì—†ìŒ/ì œê±°ìƒíƒœ",
        "notes": "ìƒì„¸ ë©”ëª¨"
      }
    }
  ],
  "floor": {
    "material": "ë§ˆë£¨/íƒ€ì¼/ì¥íŒ",
    "condition": "ì–‘í˜¸/ë³´ìˆ˜í•„ìš”",
    "color_tone": "ë°ìŒ/ì¤‘ê°„/ì–´ë‘ì›€"
  },
  "installation_constraints": {
    "recommended_cabinet_width_mm": ì¶”ì²œí­,
    "recommended_cabinet_height_mm": ì¶”ì²œë†’ì´,
    "recommended_cabinet_depth_mm": ì¶”ì²œê¹Šì´,
    "side_clearance_mm": ì¢Œìš°ì—¬ìœ ,
    "top_clearance_mm": ìƒë‹¨ì—¬ìœ ,
    "avoid_zones": ["í”¼í•´ì•¼í•  ì˜ì—­ ì„¤ëª…"]
  },
  "background_condition": {
    "wall_needs_refresh": true/false,
    "floor_needs_refresh": true/false,
    "suggested_wall_style": "í™”ì´íŠ¸ ë¬´ê´‘/ê·¸ë ˆì´ í†¤/ìš°ë“œ íŒ¨ë„ ë“±",
    "suggested_floor_style": "ë°ì€ ì›ëª©/í—¤ë§ë³¸/ê·¸ë ˆì´ íƒ€ì¼ ë“±"
  },
  "analysis_confidence": "high/medium/low",
  "additional_notes": "ì¶”ê°€ ê´€ì°° ì‚¬í•­"
}`;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DALL-E ë°°ê²½ ë³´ì • í”„ë¡¬í”„íŠ¸ ìƒì„±
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function generateDesignPrompt(category, style, wallAnalysis) {
      const info = categoryInfo[category];
      
      let basePrompt = `Professional interior design photo of a modern Korean apartment with ${info.name} (${category}) installation. Style: ${style}.`;
      
      // ë°°ê²½ ë³´ì • ì§€ì‹œ
      let backgroundPrompt = `
BACKGROUND REQUIREMENTS:
- Clean, pristine walls with smooth matte finish
- Fresh, modern wallpaper or paint (light gray or warm white tones)
- Pristine flooring - light oak hardwood or modern laminate
- No visible damage, stains, or imperfections
- Soft natural lighting from windows
- Minimalist, clutter-free space`;

      // ë²½ ë¶„ì„ ê²°ê³¼ ë°˜ì˜
      if (wallAnalysis) {
        const dims = wallAnalysis.space_analysis?.estimated_dimensions;
        const constraints = wallAnalysis.installation_constraints;
        const bgCond = wallAnalysis.background_condition;
        
        if (dims) {
          basePrompt += ` Room dimensions approximately ${dims.total_width_mm/1000}m wide, ${dims.ceiling_height_mm/1000}m ceiling height.`;
        }
        
        if (constraints) {
          basePrompt += ` Cabinet dimensions: ${constraints.recommended_cabinet_width_mm}mm wide, ${constraints.recommended_cabinet_height_mm}mm tall, ${constraints.recommended_cabinet_depth_mm}mm deep.`;
        }
        
        if (bgCond?.suggested_wall_style) {
          backgroundPrompt += `\n- Wall style: ${bgCond.suggested_wall_style}`;
        }
        if (bgCond?.suggested_floor_style) {
          backgroundPrompt += `\n- Floor style: ${bgCond.suggested_floor_style}`;
        }
      }

      // ì¹´í…Œê³ ë¦¬ë³„ íŠ¹í™” í”„ë¡¬í”„íŠ¸
      const categoryPrompts = {
        sink: `Modern kitchen with sleek built-in cabinets, integrated sink, upper and lower cabinets with hidden handles, LED under-cabinet lighting.`,
        wardrobe: `Floor-to-ceiling built-in wardrobe with sliding doors, hidden handles, internal LED lighting, mix of hanging space and shelves.`,
        fridge: `Tall cabinet unit surrounding refrigerator, pantry storage, clean integration with kitchen design.`,
        vanity: `Elegant vanity area with mirror cabinet, soft lighting, drawer storage, modern minimalist design.`,
        shoe: `Entryway shoe cabinet with ventilation, pull-out shelves, bench seating option, clean modern look.`,
        storage: `Custom storage solution with adjustable shelves, clean doors, organized interior compartments.`
      };

      const fullPrompt = `${basePrompt}

${categoryPrompts[category] || ''}

${backgroundPrompt}

STYLE DETAILS for ${style}:
${getStyleDetails(style)}

QUALITY: Ultra-realistic 3D rendering, professional interior photography, 8K quality, perfect lighting, architectural visualization.`;

      return fullPrompt;
    }

    function getStyleDetails(style) {
      const styles = {
        'ëª¨ë˜': 'Clean lines, minimalist aesthetic, matte finishes, neutral colors (white, gray, black), hidden hardware, geometric shapes.',
        'ìŠ¤ì¹¸ë””ë‚˜ë¹„ì•ˆ': 'Light wood tones, white and pastel colors, natural materials, cozy textures, simple functional design, hygge atmosphere.',
        'ì¸ë”ìŠ¤íŠ¸ë¦¬ì–¼': 'Raw materials, exposed elements, metal accents, dark tones, concrete textures, vintage industrial fixtures.',
        'ë¯¸ë‹ˆë©€': 'Essential elements only, maximum whitespace, handleless design, flush surfaces, monochromatic palette, zen-like simplicity.',
        'ëŸ­ì…”ë¦¬': 'Premium materials, gold/brass accents, rich textures, marble elements, sophisticated lighting, high-end finishes.'
      };
      return styles[style] || styles['ëª¨ë˜'];
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // State
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const state = {
      selectedStyle: 'ëª¨ë˜',
      uploadedImages: {},
      results: [],
      currentPage: 0
    };

    const categoryInfo = {
      sink: { name: 'ì‹±í¬ëŒ€', icon: 'ğŸ³' },
      wardrobe: { name: 'ë¶™ë°•ì´ì¥', icon: 'ğŸ‘”' },
      fridge: { name: 'ëƒ‰ì¥ê³ ì¥', icon: 'ğŸ§Š' },
      vanity: { name: 'í™”ì¥ëŒ€', icon: 'ğŸ’„' },
      shoe: { name: 'ì‹ ë°œì¥', icon: 'ğŸ‘Ÿ' },
      storage: { name: 'ììœ  ìˆ˜ë‚©ì¥', icon: 'ğŸ“¦' }
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Mobile Menu
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function toggleMobileMenu() {
      const hamburger = document.querySelector('.hamburger');
      const mobileMenu = document.getElementById('mobileMenu');
      hamburger.classList.toggle('active');
      mobileMenu.classList.toggle('active');
      document.body.style.overflow = mobileMenu.classList.contains('active') ? 'hidden' : '';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Category & File Upload
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function selectCategory(category) {
      document.getElementById(`file-${category}`).click();
    }

    function handleFileUpload(category, input) {
      const file = input.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        const base64Full = e.target.result;
        const base64Data = base64Full.split(',')[1];
        
        state.uploadedImages[category] = {
          base64: base64Data,
          preview: base64Full,
          type: file.type || 'image/jpeg'
        };
        
        document.getElementById(`preview-${category}`).src = base64Full;
        document.querySelector(`[data-category="${category}"]`).classList.add('has-image');
        
        updateSelectedCount();
        updateButtons();
        
        showToast(`${categoryInfo[category].name} ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ!`, 'success');
        addChatMessage(`${categoryInfo[category].icon} ${categoryInfo[category].name} ì´ë¯¸ì§€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, false);
      };
      reader.readAsDataURL(file);
    }

    function updateSelectedCount() {
      const count = Object.keys(state.uploadedImages).length;
      const countEl = document.getElementById('selectedCount');
      countEl.querySelector('span').textContent = count;
      countEl.classList.toggle('hidden', count === 0);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Remove Uploaded Image
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function removeImage(category, event) {
      event.stopPropagation(); // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
      
      if (!state.uploadedImages[category]) return;
      
      // stateì—ì„œ ì‚­ì œ
      delete state.uploadedImages[category];
      
      // UI ì—…ë°ì´íŠ¸
      const card = document.querySelector(`[data-category="${category}"]`);
      card.classList.remove('has-image');
      
      const preview = document.getElementById(`preview-${category}`);
      preview.src = '';
      
      // íŒŒì¼ input ì´ˆê¸°í™”
      const fileInput = document.getElementById(`file-${category}`);
      fileInput.value = '';
      
      updateSelectedCount();
      updateButtons();
      
      showToast(`${categoryInfo[category].name} ì´ë¯¸ì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
      addChatMessage(`${categoryInfo[category].icon} ${categoryInfo[category].name} ì´ë¯¸ì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, false);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Style Selection
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function selectStyle(el) {
      document.querySelectorAll('.style-chip').forEach(c => c.classList.remove('active'));
      el.classList.add('active');
      state.selectedStyle = el.dataset.style;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Button State
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function updateButtons() {
      const hasImages = Object.keys(state.uploadedImages).length > 0;
      document.getElementById('generateBtn').disabled = !hasImages;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Progress Steps
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function updateStep(stepNum, status, text) {
      // status: 'active', 'done', ''
      for (let i = 1; i <= 4; i++) {
        const step = document.getElementById(`step${i}`);
        step.classList.remove('active', 'done');
        if (i < stepNum) step.classList.add('done');
        if (i === stepNum) step.classList.add(status);
      }
      document.getElementById('progressText').textContent = text;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAIN GENERATION FLOW
    // ì´ë¯¸ì§€ ì—…ë¡œë“œ â†’ ë²½ ë¶„ì„ â†’ DALL-E3 ìƒì„± (ë¶„ì„ ê²°ê³¼ ë°˜ì˜)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function startGeneration() {
      const categories = Object.keys(state.uploadedImages);
      if (categories.length === 0) {
        showToast('ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'error');
        return;
      }

      const btn = document.getElementById('generateBtn');
      const progressSteps = document.getElementById('progressSteps');
      const placeholder = document.getElementById('resultPlaceholder');
      const loading = document.getElementById('resultLoading');
      const pagesContainer = document.getElementById('resultPages');

      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div> ìƒì„± ì¤‘...';
      progressSteps.classList.add('active');
      placeholder.classList.add('hidden');
      pagesContainer.innerHTML = '';
      loading.classList.add('active');

      state.results = [];
      const total = categories.length;

      for (let i = 0; i < categories.length; i++) {
        const category = categories[i];
        const imageData = state.uploadedImages[category];
        const info = categoryInfo[category];

        let wallAnalysis = null;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STEP 1: ì´ë¯¸ì§€ ë¶„ì„ ì‹œì‘
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        updateStep(1, 'active', `${info.icon} ${info.name} ì´ë¯¸ì§€ ë¶„ì„ ì¤‘... (${i + 1}/${total})`);
        document.getElementById('loadingTitle').textContent = `${info.icon} ì´ë¯¸ì§€ ë¶„ì„ ì¤‘...`;
        document.getElementById('loadingText').textContent = `${i + 1} / ${total}`;
        await sleep(500);

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STEP 2: ë²½ êµ¬ì¡° ë¶„ì„ (ìƒˆ ì›Œí¬í”Œë¡œìš°ì—ì„œ í†µí•© ì²˜ë¦¬)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        updateStep(2, 'active', `${info.icon} ë²½ êµ¬ì¡° ë¶„ì„ ì¤‘...`);
        document.getElementById('loadingTitle').textContent = `ğŸ§± ìƒì„¸ ê³µê°„ ë¶„ì„ ì¤‘...`;
        await sleep(300);
        // ë²½ ë¶„ì„ì€ ì´ì œ interior-design APIì—ì„œ í†µí•© ì²˜ë¦¬ë¨

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STEP 3: DALL-E3 ë””ìì¸ ìƒì„± (ë²½ ë¶„ì„ ê²°ê³¼ + ë°°ê²½ ë³´ì • ë°˜ì˜)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        updateStep(3, 'active', `${info.icon} AI ë””ìì¸ ìƒì„± ì¤‘...`);
        document.getElementById('loadingTitle').textContent = `âœ¨ ë””ìì¸ ìƒì„± ì¤‘...`;

        // ìƒì„¸ í”„ë¡¬í”„íŠ¸ ìƒì„± (ë²½ ë¶„ì„ + ë°°ê²½ ë³´ì • í¬í•¨)
        const designPrompt = generateDesignPrompt(category, state.selectedStyle, wallAnalysis);
        console.log('Design Prompt:', designPrompt);

        try {
          const response = await fetch(N8N_INTERIOR_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              room_image: imageData.base64,
              image_type: imageData.type,
              design_style: state.selectedStyle,
              additional_request: designPrompt
            })
          });

          if (!response.ok) throw new Error(`HTTP ${response.status}`);

          let data = await response.json();
          if (Array.isArray(data)) data = data[0];
          
          // ìƒˆ ì›Œí¬í”Œë¡œìš° ì‘ë‹µ í˜•ì‹ ì²˜ë¦¬
          const generatedImageUrl = data.generated_image?.data_url || data.generated_image?.url || '';
          const roomAnalysis = data.room_analysis?.summary || data.room_analysis || 'ë¶„ì„ ê²°ê³¼ ì—†ìŒ';
          const designSuggestions = JSON.stringify(data.design_recommendation) || data.design_suggestions || 'ì œì•ˆ ì—†ìŒ';

          state.results.push({
            category,
            beforeUrl: imageData.preview,
            afterUrl: generatedImageUrl,
            analysis: roomAnalysis,
            suggestions: designSuggestions,
            wallAnalysis: data.room_analysis || wallAnalysis
          });

        } catch (error) {
          console.error(`Error generating ${category}:`, error);
          state.results.push({
            category,
            beforeUrl: imageData.preview,
            afterUrl: '',
            analysis: 'ìƒì„± ì‹¤íŒ¨',
            suggestions: error.message,
            wallAnalysis: wallAnalysis
          });
        }
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // STEP 4: ì™„ë£Œ
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      updateStep(4, 'done', 'âœ… ëª¨ë“  ë””ìì¸ ìƒì„± ì™„ë£Œ!');

      loading.classList.remove('active');
      renderResultPages();

      btn.disabled = false;
      btn.innerHTML = 'âœ¨ AI ë””ìì¸ ìƒì„±í•˜ê¸°';
      updateButtons();

      document.getElementById('downloadBtn').disabled = false;
      document.getElementById('shareBtn').disabled = false;

      showToast(`${state.results.length}ê°œ ë””ìì¸ ìƒì„± ì™„ë£Œ!`, 'success');
      addChatMessage(`ğŸ‰ ${state.results.length}ê°œì˜ ê³µê°„ ë””ìì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`, false);

      setTimeout(() => {
        progressSteps.classList.remove('active');
        document.querySelector('.result-section').scrollIntoView({ behavior: 'smooth' });
      }, 1500);
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDER RESULT PAGES (ìƒì„¸ ë¶„ì„ ê²°ê³¼ í¬í•¨)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function renderResultPages() {
      const pagesContainer = document.getElementById('resultPages');
      const pageNav = document.getElementById('pageNav');
      const pageIndicator = document.getElementById('pageIndicator');

      pagesContainer.innerHTML = '';

      if (state.results.length === 0) return;

      state.results.forEach((result, index) => {
        const page = document.createElement('div');
        page.className = `result-page ${index === 0 ? 'active' : ''}`;
        page.dataset.index = index;

        const info = categoryInfo[result.category];
        const wa = result.wallAnalysis;

        // ìƒì„¸ Wall Analysis HTML
        let wallAnalysisHTML = '';
        if (wa) {
          // ì¹˜ìˆ˜ ì •ë³´
          const dims = wa.space_analysis?.estimated_dimensions || wa.estimated_dimensions || {};
          const constraints = wa.installation_constraints || {};
          const bgCond = wa.background_condition || {};
          
          // ê¸°ë³¸ ë ˆì´ì•„ì›ƒ íƒ€ì… (ì´ì „ ë²„ì „ í˜¸í™˜)
          const layoutType = wa.space_analysis?.layout_type || wa.layout_type || '-';
          
          // ì¶”ì • ì¹˜ìˆ˜
          const totalWidth = dims.total_width_mm || '-';
          const ceilingHeight = dims.ceiling_height_mm || '-';
          const depth = dims.depth_mm || constraints.recommended_cabinet_depth_mm || '-';
          
          // ì„¤ì¹˜ ê°€ëŠ¥ ì˜ì—­
          const installWidth = constraints.recommended_cabinet_width_mm || '-';
          const installHeight = constraints.recommended_cabinet_height_mm || '-';
          const installDepth = constraints.recommended_cabinet_depth_mm || '-';
          
          // ì¥ì• ë¬¼ ëª©ë¡
          let obstaclesHTML = '';
          const walls = wa.walls || [];
          walls.forEach(wall => {
            if (wall.obstacles && wall.obstacles.length > 0) {
              wall.obstacles.forEach(obs => {
                const icon = getObstacleIcon(obs.type);
                obstaclesHTML += `<span class="obstacle-tag ${obs.clearance_required_mm > 100 ? 'warning' : ''}">${icon} ${obs.type} (${obs.position_mm || obs.size_mm || ''})</span>`;
              });
            }
            // ì´ì „ ë²„ì „ í˜¸í™˜
            if (wall.features) {
              if (wall.features.has_window) obstaclesHTML += `<span class="obstacle-tag">ğŸªŸ ì°½ë¬¸</span>`;
              if (wall.features.has_door) obstaclesHTML += `<span class="obstacle-tag">ğŸšª ë¬¸</span>`;
              if (wall.features.has_outlet) obstaclesHTML += `<span class="obstacle-tag">ğŸ”Œ ì½˜ì„¼íŠ¸</span>`;
              if (wall.features.has_pipe) obstaclesHTML += `<span class="obstacle-tag warning">ğŸ”§ ë°°ê´€</span>`;
            }
          });
          
          // í”¼í•´ì•¼ í•  ì˜ì—­
          if (wa.obstacles && wa.obstacles.length > 0) {
            wa.obstacles.forEach(obs => {
              obstaclesHTML += `<span class="obstacle-tag">${obs}</span>`;
            });
          }
          
          // ë°°ê²½ ë³´ì • ê¶Œì¥ ì‚¬í•­
          let bgRefreshHTML = '';
          if (bgCond.wall_needs_refresh || bgCond.floor_needs_refresh) {
            bgRefreshHTML = `
              <div class="bg-refresh-box">
                <h5>âœ¨ ë°°ê²½ ë³´ì • ì ìš©ë¨</h5>
                ${bgCond.wall_needs_refresh ? `<div class="bg-refresh-item">ğŸ¨ ë²½ë©´: ${bgCond.suggested_wall_style || 'ê¹”ë”í•œ í™”ì´íŠ¸ í†¤'}</div>` : ''}
                ${bgCond.floor_needs_refresh ? `<div class="bg-refresh-item">ğŸªµ ë°”ë‹¥: ${bgCond.suggested_floor_style || 'ë°ì€ ì›ëª© ë§ˆë£¨'}</div>` : ''}
              </div>
            `;
          }

          wallAnalysisHTML = `
            <div class="wall-analysis-box">
              <h4>ğŸ“ ìƒì„¸ ê³µê°„ ë¶„ì„ <span class="badge">Claude Vision AI</span></h4>
              
              <!-- ì¶”ì • ì¹˜ìˆ˜ -->
              <div class="dimension-display">
                <div class="dimension-item">
                  <div class="value">${formatDimension(totalWidth)}</div>
                  <div class="unit">mm</div>
                  <div class="label">ì „ì²´ í­</div>
                </div>
                <div class="dimension-item">
                  <div class="value">${formatDimension(ceilingHeight)}</div>
                  <div class="unit">mm</div>
                  <div class="label">ì²œì¥ ë†’ì´</div>
                </div>
                <div class="dimension-item">
                  <div class="value">${formatDimension(depth)}</div>
                  <div class="unit">mm</div>
                  <div class="label">ì„¤ì¹˜ ê¹Šì´</div>
                </div>
              </div>
              
              <!-- ì„¤ì¹˜ ê°€ëŠ¥ ì˜ì—­ -->
              <div class="install-zone">
                <div class="title">ğŸ¯ ê¶Œì¥ ì„¤ì¹˜ ì¹˜ìˆ˜</div>
                <div class="dims">${formatDimension(installWidth)} Ã— ${formatDimension(installHeight)} Ã— ${formatDimension(installDepth)} mm</div>
              </div>
              
              <!-- ê¸°ë³¸ ì •ë³´ -->
              <div class="wall-info-grid">
                <div class="wall-info-item">
                  <div class="label">ë ˆì´ì•„ì›ƒ</div>
                  <div class="value">${layoutType}</div>
                </div>
                <div class="wall-info-item">
                  <div class="label">ì¢Œìš° ì—¬ìœ </div>
                  <div class="value">${constraints.side_clearance_mm || 10}mm</div>
                </div>
                <div class="wall-info-item">
                  <div class="label">ìƒë‹¨ ì—¬ìœ </div>
                  <div class="value">${constraints.top_clearance_mm || 10}mm</div>
                </div>
              </div>
              
              <!-- ì¥ì• ë¬¼ -->
              ${obstaclesHTML ? `
                <div style="margin-top:12px">
                  <div style="font-size:11px;color:var(--gray);margin-bottom:6px">âš ï¸ ê°ì§€ëœ ì¥ì• ë¬¼</div>
                  <div class="obstacles-list">${obstaclesHTML}</div>
                </div>
              ` : ''}
              
              <!-- ë°°ê²½ ë³´ì • -->
              ${bgRefreshHTML}
            </div>
          `;
        }

        page.innerHTML = `
          <div class="page-category">
            <span class="icon">${info.icon}</span>
            ${info.name}
          </div>
          
          ${wallAnalysisHTML}
          
          <div class="result-grid">
            <div class="result-card">
              <div class="result-card-header">
                <div class="dot before"></div>
                <span>Before - ì›ë³¸</span>
              </div>
              <img src="${result.beforeUrl}" alt="Before">
            </div>
            <div class="result-card">
              <div class="result-card-header">
                <div class="dot after"></div>
                <span>After - AI ë¦¬ë””ìì¸</span>
              </div>
              <img src="${result.afterUrl || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>âŒ</text></svg>'}" alt="After" 
                   onclick="${result.afterUrl ? `window.open('${result.afterUrl}', '_blank')` : ''}"
                   style="cursor: ${result.afterUrl ? 'pointer' : 'default'}">
            </div>
          </div>
          
          <div class="result-analysis">
            <div class="analysis-card">
              <h4>ğŸ“Š ê³µê°„ ë¶„ì„</h4>
              <p>${result.analysis}</p>
            </div>
            <div class="analysis-card">
              <h4>ğŸ’¡ ë””ìì¸ ì œì•ˆ</h4>
              <p>${result.suggestions}</p>
            </div>
          </div>
        `;

        pagesContainer.appendChild(page);
      });

      // Page navigation
      if (state.results.length > 1) {
        pageNav.classList.remove('hidden');
        pageIndicator.innerHTML = state.results.map((_, i) => 
          `<div class="page-dot ${i === 0 ? 'active' : ''}" onclick="goToPage(${i})"></div>`
        ).join('');
        document.getElementById('totalPages').textContent = state.results.length;
        updatePageNav();
      } else {
        pageNav.classList.add('hidden');
      }

      state.currentPage = 0;
    }

    function formatDimension(value) {
      if (!value || value === '-') return '-';
      if (typeof value === 'number') {
        return value.toLocaleString();
      }
      return value;
    }

    function getObstacleIcon(type) {
      const icons = {
        'ë¬¸': 'ğŸšª', 'ì°½ë¬¸': 'ğŸªŸ', 'ì½˜ì„¼íŠ¸': 'ğŸ”Œ', 'ë°°ê´€': 'ğŸ”§',
        'ì—ì–´ì»¨': 'â„ï¸', 'ìŠ¤ìœ„ì¹˜': 'ğŸ’¡', 'í™˜ê¸°êµ¬': 'ğŸŒ€', 'ê¸°ë‘¥': 'ğŸ›ï¸'
      };
      return icons[type] || 'âš ï¸';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Page Navigation
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function changePage(delta) {
      const newPage = state.currentPage + delta;
      if (newPage >= 0 && newPage < state.results.length) {
        goToPage(newPage);
      }
    }

    function goToPage(index) {
      state.currentPage = index;
      document.querySelectorAll('.result-page').forEach((page, i) => {
        page.classList.toggle('active', i === index);
      });
      document.querySelectorAll('.page-dot').forEach((dot, i) => {
        dot.classList.toggle('active', i === index);
      });
      updatePageNav();
    }

    function updatePageNav() {
      document.getElementById('currentPage').textContent = state.currentPage + 1;
      document.getElementById('prevPage').disabled = state.currentPage === 0;
      document.getElementById('nextPage').disabled = state.currentPage === state.results.length - 1;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Download & Share
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function downloadCurrentImage() {
      const result = state.results[state.currentPage];
      if (!result?.afterUrl) {
        showToast('ë‹¤ìš´ë¡œë“œí•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
        return;
      }
      const link = document.createElement('a');
      link.href = result.afterUrl;
      link.target = '_blank';
      link.download = `dadam-${result.category}-design.png`;
      link.click();
      showToast('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‹œì‘', 'success');
    }

    async function shareResult() {
      const result = state.results[state.currentPage];
      if (!result?.afterUrl) return;
      try {
        if (navigator.share) {
          await navigator.share({
            title: `ë‹¤ë‹´ê°€êµ¬ AI ë¦¬ë””ìì¸ - ${categoryInfo[result.category].name}`,
            text: `${categoryInfo[result.category].name}ë¥¼ "${state.selectedStyle}" ìŠ¤íƒ€ì¼ë¡œ ë¦¬ë””ìì¸í–ˆì–´ìš”!`,
            url: result.afterUrl
          });
        } else {
          await navigator.clipboard.writeText(result.afterUrl);
          showToast('URLì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }
      } catch (e) {
        showToast('ê³µìœ í•˜ê¸° ì‹¤íŒ¨', 'error');
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Chat
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function addChatMessage(content, isUser = false) {
      const chatMessages = document.getElementById('chatMessages');
      const welcome = chatMessages.querySelector('.welcome-msg');
      if (welcome) welcome.remove();

      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
      messageDiv.innerHTML = `
        <div class="message-avatar">
          <svg fill="${isUser ? 'none' : 'currentColor'}" stroke="${isUser ? 'currentColor' : 'none'}" stroke-width="2">
            <use href="#icon-${isUser ? 'user' : 'ai'}"/>
          </svg>
        </div>
        <div class="message-content">${content}</div>
      `;
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;

      const messages = chatMessages.querySelectorAll('.message');
      if (messages.length > 3) messages[0].remove();
    }

    async function sendMessage() {
      const input = document.getElementById('messageInput');
      const message = input.value.trim();
      if (!message) return;

      addChatMessage(message, true);
      input.value = '';

      try {
        const response = await fetch(N8N_CHAT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message })
        });
        const data = await response.json();
        addChatMessage(data.response || data.output || 'ì‘ë‹µì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', false);
      } catch (error) {
        addChatMessage('ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', false);
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Toast
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type} show`;
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Keyboard & Touch
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.addEventListener('keydown', (e) => {
      if (state.results.length > 1) {
        if (e.key === 'ArrowLeft') changePage(-1);
        if (e.key === 'ArrowRight') changePage(1);
      }
    });

    let touchStartX = 0;
    document.getElementById('resultPages').addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });

    document.getElementById('resultPages').addEventListener('touchend', (e) => {
      const diff = touchStartX - e.changedTouches[0].screenX;
      if (Math.abs(diff) > 50) changePage(diff > 0 ? 1 : -1);
    }, { passive: true });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Init
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.addEventListener('DOMContentLoaded', updateButtons);
  </script>
</body>
</html>
